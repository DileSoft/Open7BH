import{j as i,d as me,a as fe,b as ke,c as Se,e as $e,f as Oe,g as Re,h as Le,i as je,k as c,F as Z,l as ge,m as K,B as A,v as E,S as g,M as x,T as C,n as xe,I as le,o as Ee,p as _e,q as ze,s as De,r as Me,t as $,G as N,u as Ae,w as ee,D as Te,x as Je,y as Fe,C as ne,z as Be,A as Pe,E as Ge,R as We}from"./vendor.d5892523.js";const qe=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?e.credentials="include":t.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function n(t){if(t.ep)return;t.ep=!0;const e=o(t);fetch(t.href,e)}};qe();const P=a=>a.split("x").map(l=>parseInt(l)),T=a=>{const l={};return a.split(/[\r\n]+/).forEach((o,n)=>{o.split(/ +/).forEach((t,e)=>{const r=t.split("|"),s={type:r[0]};r[0]==="box"&&(s.type="empty",s.item={type:"box",value:parseInt(r[1]),tag:r[2],isRandom:r[1]==="random"}),l[`${e}x${n}`]=s})}),l},oe=a=>{var t;let l="",o=0,n=0;Object.keys(a).forEach(e=>{const r=P(e);r[0]+1>o&&(o=r[0]+1),r[1]+1>n&&(n=r[1]+1)});for(let e=0;e<n;e++){for(let r=0;r<o;r++){const s=a[`${r}x${e}`];s?s.type!=="empty"?l+=`${s.type} `:((t=s.item)==null?void 0:t.type)==="box"?l+=`box|${s.item.isRandom?"random":s.item.value}|${s.item.tag||""} `:l+="empty ":l+="nothing "}l=`${l.trim()}
`}return l.trim()},Ve=a=>a[Math.floor(Math.random()*a.length)],we=(a,l)=>(a=Math.ceil(a),l=Math.floor(l),Math.floor(Math.random()*(l-a+1))+a),J=(a,l)=>{const o=[...a];return l==="left"&&(o[0]-=1),l==="right"&&(o[0]+=1),l==="top"&&(o[1]-=1),l==="bottom"&&(o[1]+=1),l==="top-left"&&(o[0]-=1,o[1]-=1),l==="top-right"&&(o[0]+=1,o[1]-=1),l==="bottom-left"&&(o[0]-=1,o[1]+=1),l==="bottom-right"&&(o[0]+=1,o[1]+=1),o},D=a=>{const o={left:me,right:fe,top:ke,bottom:Se,"top-left":$e,"top-right":Oe,"bottom-left":Re,"bottom-right":Le,here:je}[a];return o?i(o,{fontSize:"small"}):null},d=a=>JSON.parse(JSON.stringify(a)),Ce=(a,l)=>a.find(o=>o.coordinates===l),M=80;function be(a){const l=Object.keys(a.cells).map(n=>{var s;const t=P(n),e=a.cells[n];let r;return(e.type==="empty"||e.type==="nothing")&&(r=null),e.type==="hole"&&(r=i("div",{style:{width:"100%",height:"100%",backgroundColor:"black"}})),e.type==="wall"&&(r="wall"),e.type==="printer"&&(r="printer"),e.type==="shredder"&&(r="shredder"),((s=e.item)==null?void 0:s.type)==="box"&&(r=c(Z,{children:[i(ge,{fontSize:"small"})," ",e.item.isRandom&&!a.run?"?":e.item.value]})),i("div",{onClick:()=>a.onClick(n),style:{position:"absolute",left:t[0]*M,top:t[1]*M,width:M,height:M,borderStyle:e.type==="nothing"?"dotted":"solid",borderColor:"black",borderWidth:1,display:"flex",alignItems:"center",justifyContent:"center"},children:r},n)}),o=a.characters.map(n=>{var e;const t=P(n.coordinates);return c("div",{style:{position:"absolute",opacity:n.terminated?0:1,transform:`translate(${t[0]*M}px, ${t[1]*M+10}px)`,transition:`all ${a.speed}ms ease-in`},children:[i(K,{fontSize:"small",style:{color:n.color}}),((e=n.item)==null?void 0:e.type)==="box"?c(Z,{children:["(",i(ge,{fontSize:"small"})," ",n.item.value,")"]}):null]},n.name)});return c("div",{style:{position:"relative",width:a.width*M+M/2,height:a.height*M+M/2},children:[l,o]})}const He=[{type:"step",add:a=>{a.push({type:"step",destination:{type:"direction",directions:["left"]},id:E()})}},{type:"give",add:a=>{a.push({type:"give",direction:{type:"direction",value:"left"},id:E()})}},{type:"take",add:a=>{a.push({type:"take",direction:{type:"direction",value:"left"},id:E()})}},{type:"goto",add:a=>{a.push({type:"goto",step:0,id:E()})}},{type:"pickup",add:a=>{a.push({type:"pickup",id:E()})}},{type:"drop",add:a=>{a.push({type:"drop",id:E()})}},{type:"if",add:a=>{const l=E();a.push({type:"if",conditions:[{value1:{type:"direction",value:"here"},operation:"==",value2:{type:"number",value:0},logic:"OR"}],id:l},{type:"endif",ifId:l})}},{type:"near",add:a=>{a.push({type:"near",find:"wall",slot:1,id:E()})}},{type:"variable",add:a=>{a.push({type:"variable",slot:1,value:{type:"number",value:0},id:E()})}},{type:"calc",add:a=>{a.push({type:"calc",slot:1,value1:{type:"number",value:0},operation:"+",value2:{type:"number",value:0},id:E()})}},{type:"say",add:a=>{a.push({type:"say",text:"hi",target:{type:"direction",value:"left"},id:E()})}},{type:"hear",add:a=>{a.push({type:"hear",text:"hi",id:E()})}},{type:"foreach",add:a=>{const l=E();a.push({type:"foreach",directions:["left"],slot:1,id:l},{type:"endforeach",foreachId:l})}}];function Qe(a){return i(Z,{children:He.map(l=>i("div",{children:i(A,{onClick:()=>{const o=[...a.code];l.add(o),a.setCode(o)},children:`Add ${l.type}`})},l.type))})}const Ue=(a,l,o,n)=>c("span",{children:["Step:"," ",i(g,{IconComponent:null,value:a.destination.type,onChange:t=>{const e=d(o);t.target.value==="direction"&&(e[l].destination={type:"direction",directions:["left"]}),t.target.value==="slot"&&(e[l].destination={type:"slot",slot:1}),n(e)},variant:"standard",children:["direction","slot"].map(t=>i(x,{value:t,children:t},t))}),a.destination.type==="direction"&&i(g,{IconComponent:null,value:a.destination.directions,variant:"standard",multiple:!0,onChange:t=>{const e=d(o);e[l].destination.directions=t.target.value,n(e)},children:["left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"].map(t=>c(x,{value:t,children:[D(t),t]},t))}),a.destination.type==="slot"&&i(C,{type:"number",value:a.destination.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].destination.slot=parseInt(t.target.value)||0,n(e)}})]}),Xe=(a,l,o,n)=>c("span",{children:["Give:"," ",i(K,{fontSize:"small"}),i(fe,{fontSize:"small"}),i(xe,{fontSize:"small"})," ",i(g,{IconComponent:null,value:a.direction.type,onChange:t=>{const e=d(o);t.target.value==="direction"&&(e[l].direction={type:"direction",value:"left"}),t.target.value==="slot"&&(e[l].direction={type:"slot",slot:1}),n(e)},variant:"standard",children:["direction","slot"].map(t=>i(x,{value:t,children:t},t))}),i(g,{IconComponent:null,value:a.direction.value,variant:"standard",onChange:t=>{const e=d(o);e[l].direction.value=t.target.value,n(e)},children:["left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"].map(t=>c(x,{value:t,children:[D(t),t]},t))}),a.direction.type==="slot"&&i(C,{type:"number",value:a.direction.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].direction.slot=parseInt(t.target.value)||0,n(e)}})]}),Ye=(a,l,o,n)=>c("span",{children:["Take"," ",i(K,{fontSize:"small"}),i(me,{fontSize:"small"}),i(xe,{fontSize:"small"})," ",i(g,{IconComponent:null,value:a.direction.type,onChange:t=>{const e=d(o);t.target.value==="direction"&&(e[l].direction={type:"direction",value:"left"}),t.target.value==="slot"&&(e[l].direction={type:"slot",slot:1}),n(e)},variant:"standard",children:["direction","slot"].map(t=>i(x,{value:t,children:t},t))}),i(g,{IconComponent:null,value:a.direction.value,variant:"standard",onChange:t=>{const e=d(o);e[l].direction.value=t.target.value,n(e)},children:["left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"].map(t=>c(x,{value:t,children:[D(t),t]},t))}),a.direction.type==="slot"&&i(C,{type:"number",value:a.direction.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].direction.slot=parseInt(t.target.value)||0,n(e)}})]}),Ze=(a,l,o,n)=>c("span",{children:["Goto:"," ",i(g,{IconComponent:null,value:a.step,variant:"standard",onChange:t=>{const e=d(o);e[l].step=t.target.value,n(e)},children:Object.keys(o).map(t=>i(x,{value:t,children:t},t))})]}),Ke=(a,l,o,n)=>c("span",{children:["If:"," ",a.conditions.map((t,e)=>c("span",{children:[!!e&&i(g,{IconComponent:null,value:t.logic,variant:"standard",onChange:r=>{const s=d(o);s[l].conditions[e].logic=r.target.value,n(s)},children:["OR","AND"].map(r=>i(x,{value:r,children:r},r))}),i(g,{IconComponent:null,value:t.value1.type,onChange:r=>{const s=d(o);r.target.value==="myitem"&&(s[l].conditions[e].value1={type:"myitem"}),r.target.value==="direction"&&(s[l].conditions[e].value1={type:"direction",value:"left"}),r.target.value==="slot"&&(s[l].conditions[e].value1={type:"slot",slot:1}),n(s)},variant:"standard",children:["direction","myitem","slot"].map(r=>i(x,{value:r,children:r},r))}),t.value1.type==="direction"&&i(g,{IconComponent:null,value:t.value1.value,variant:"standard",onChange:r=>{const s=d(o);s[l].conditions[e].value1.value=r.target.value,n(s)},children:["left","right","top","bottom","here","top-left","top-right","bottom-left","bottom-right"].map(r=>c(x,{value:r,children:[D(r),r]},r))}),t.value1.type==="slot"&&i(C,{type:"number",value:t.value1.slot,variant:"standard",onChange:r=>{const s=d(o);s[l].conditions[e].value1.slot=parseInt(r.target.value)||0,n(s)}}),i(g,{IconComponent:null,value:t.operation,variant:"standard",onChange:r=>{const s=d(o);s[l].conditions[e].operation=r.target.value,n(s)},children:["==",">","<",">=","<="].map(r=>i(x,{value:r,children:r},r))}),i(g,{IconComponent:null,value:a.conditions[e].value2.type,onChange:r=>{const s=d(o);r.target.value==="number"&&(s[l].conditions[e].value2={type:"number",value:0}),r.target.value==="myitem"&&(s[l].conditions[e].value2={type:"myitem"}),r.target.value==="direction"&&(s[l].conditions[e].value2={type:"direction",value:"left"}),r.target.value==="slot"&&(s[l].conditions[e].value2={type:"slot",slot:1}),r.target.value==="something"&&(s[l].conditions[e].value2={type:"something"}),r.target.value==="empty"&&(s[l].conditions[e].value2={type:"empty"}),r.target.value==="hole"&&(s[l].conditions[e].value2={type:"hole"}),r.target.value==="character"&&(s[l].conditions[e].value2={type:"character"}),n(s)},variant:"standard",children:["number","direction","slot","myitem","something","empty","hole","character","box"].map(r=>i(x,{value:r,children:r},r))}),t.value2.type==="number"&&i(C,{type:"number",value:t.value2.value,variant:"standard",onChange:r=>{const s=d(o);s[l].conditions[e].value2.value=parseInt(r.target.value)||0,n(s)}}),t.value2.type==="direction"&&i(g,{IconComponent:null,value:t.value2.value,variant:"standard",onChange:r=>{const s=d(o);s[l].conditions[e].value2.value=r.target.value,n(s)},children:["left","right","top","bottom","here","top-left","top-right","bottom-left","bottom-right"].map(r=>c(x,{value:r,children:[D(r),r]},r))}),t.value2.type==="slot"&&i(C,{type:"number",value:t.value2.slot,variant:"standard",onChange:r=>{const s=d(o);s[l].conditions[e].value2.slot=parseInt(r.target.value)||0,n(s)}}),i(le,{size:"small",onMouseDown:()=>{const r=d(o);r[l].conditions.splice(e,1),n(r)},children:i(Ee,{})}),e===a.conditions.length-1&&i(le,{size:"small",onMouseDown:()=>{const r=d(o);r[l].conditions.push({value1:{type:"direction",value:"here"},operation:"==",value2:{type:"number",value:0},logic:"OR"}),n(r)},children:i(_e,{})})]},e))]}),Ne=()=>"Pickup",et=()=>"Drop",tt=(a,l,o,n)=>c("span",{children:["Near:"," ","slot",i(C,{type:"number",value:a.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].slot=parseInt(t.target.value)||0,n(e)}}),"=",i(g,{IconComponent:null,value:a.find,onChange:t=>{const e=d(o);e[l].find=t.target.value,n(e)},variant:"standard",children:["box","wall","hole","character","printer","shredder"].map(t=>i(x,{value:t,children:t},t))})]}),at=(a,l,o,n)=>c("span",{children:["Variable"," ","slot",i(C,{type:"number",value:a.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].slot=parseInt(t.target.value)||0,n(e)}}),"=",i(g,{IconComponent:null,value:a.value.type,onChange:t=>{const e=d(o);t.target.value==="number"&&(e[l].value={type:"number",value:0}),t.target.value==="myitem"&&(e[l].value={type:"myitem"}),t.target.value==="direction"&&(e[l].value={type:"direction",value:"left"}),t.target.value==="slot"&&(e[l].value={type:"slot",slot:1}),n(e)},variant:"standard",children:["number","direction","slot","myitem"].map(t=>i(x,{value:t,children:t},t))}),a.value.type==="number"&&i(C,{type:"number",value:a.value.value,variant:"standard",onChange:t=>{const e=d(o);e[l].value.value=parseInt(t.target.value)||0,n(e)}}),a.value.type==="direction"&&i(g,{IconComponent:null,value:a.value.value,variant:"standard",onChange:t=>{const e=d(o);e[l].value.value=t.target.value,n(e)},children:["left","right","top","bottom","here","top-left","top-right","bottom-left","bottom-right"].map(t=>c(x,{value:t,children:[D(t),t]},t))}),a.value.type==="slot"&&i(C,{type:"number",value:a.value.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].value.slot=parseInt(t.target.value)||0,n(e)}})]}),lt=(a,l,o,n)=>c("span",{children:["Calc"," ","slot",i(C,{type:"number",value:a.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].slot=parseInt(t.target.value)||0,n(e)}}),"=",i(g,{IconComponent:null,value:a.value1.type,onChange:t=>{const e=d(o);t.target.value==="number"&&(e[l].value1={type:"number",value:0}),t.target.value==="myitem"&&(e[l].value1={type:"myitem"}),t.target.value==="direction"&&(e[l].value1={type:"direction",value:"left"}),t.target.value==="slot"&&(e[l].value1={type:"slot",slot:1}),n(e)},variant:"standard",children:["number","direction","slot","myitem"].map(t=>i(x,{value:t,children:t},t))}),a.value1.type==="number"&&i(C,{type:"number",value:a.value1.value,variant:"standard",onChange:t=>{const e=d(o);e[l].value1.value=parseInt(t.target.value)||0,n(e)}}),a.value1.type==="direction"&&i(g,{IconComponent:null,value:a.value1.value,variant:"standard",onChange:t=>{const e=d(o);e[l].value1.value=t.target.value,n(e)},children:["left","right","top","bottom","here","top-left","top-right","bottom-left","bottom-right"].map(t=>c(x,{value:t,children:[D(t),t]},t))}),a.value1.type==="slot"&&i(C,{type:"number",value:a.value1.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].value1.slot=parseInt(t.target.value)||0,n(e)}}),i(g,{IconComponent:null,value:a.operation,variant:"standard",onChange:t=>{const e=d(o);e[l].operation=t.target.value,n(e)},children:["+","-","*","/"].map(t=>i(x,{value:t,children:t},t))}),i(g,{IconComponent:null,value:a.value2.type,onChange:t=>{const e=d(o);t.target.value==="number"&&(e[l].value2={type:"number",value:0}),t.target.value==="myitem"&&(e[l].value2={type:"myitem"}),t.target.value==="direction"&&(e[l].value2={type:"direction",value:"left"}),t.target.value==="slot"&&(e[l].value2={type:"slot",slot:1}),n(e)},variant:"standard",children:["number","direction","slot","myitem"].map(t=>i(x,{value:t,children:t},t))}),a.value2.type==="number"&&i(C,{type:"number",value:a.value2.value,variant:"standard",onChange:t=>{const e=d(o);e[l].value2.value=parseInt(t.target.value)||0,n(e)}}),a.value2.type==="direction"&&i(g,{IconComponent:null,value:a.value2.value,variant:"standard",onChange:t=>{const e=d(o);e[l].value2.value=t.target.value,n(e)},children:["left","right","top","bottom","here","top-left","top-right","bottom-left","bottom-right"].map(t=>c(x,{value:t,children:[D(t),t]},t))}),a.value2.type==="slot"&&i(C,{type:"number",value:a.value2.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].value2.slot=parseInt(t.target.value)||0,n(e)}})]}),nt=(a,l,o,n)=>c("span",{children:["Say:"," ",i(C,{value:a.text,variant:"standard",onChange:t=>{const e=d(o);e[l].text=t.target.value,n(e)}}),i(g,{IconComponent:null,value:a.target.type,onChange:t=>{const e=d(o);t.target.value==="direction"&&(e[l].target={type:"direction",value:"left"}),t.target.value==="slot"&&(e[l].target={type:"slot",slot:1}),t.target.value==="all"&&(e[l].target={type:"all"}),n(e)},variant:"standard",children:["direction","all","slot"].map(t=>i(x,{value:t,children:t},t))}),a.target.type==="direction"&&i(g,{IconComponent:null,value:a.target.value,variant:"standard",onChange:t=>{const e=d(o);e[l].target.value=t.target.value,n(e)},children:["left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"].map(t=>c(x,{value:t,children:[D(t),t]},t))}),a.target.type==="slot"&&i(C,{type:"number",value:a.target.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].target.slot=parseInt(t.target.value)||0,n(e)}})]}),ot=(a,l,o,n)=>c("span",{children:["Hear:"," ",i(C,{value:a.text,variant:"standard",onChange:t=>{const e=d(o);e[l].text=t.target.value,n(e)}})]}),it=(a,l,o,n)=>c("span",{children:["Foreach:"," ",i(g,{IconComponent:null,value:a.directions,variant:"standard",multiple:!0,onChange:t=>{const e=d(o);e[l].directions=t.target.value,n(e)},children:["left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"].map(t=>c(x,{value:t,children:[D(t),t]},t))}),i(C,{type:"number",value:a.slot,variant:"standard",onChange:t=>{const e=d(o);e[l].slot=parseInt(t.target.value)||0,n(e)}})]});function rt(a,l,o,n,t){let e=null;return a.type==="step"&&(e=Ue(a,l,o,n)),a.type==="give"&&(e=Xe(a,l,o,n)),a.type==="take"&&(e=Ye(a,l,o,n)),a.type==="goto"&&(e=Ze(a,l,o,n)),a.type==="if"&&(e=Ke(a,l,o,n)),a.type==="endif"&&(e="Endif"),a.type==="pickup"&&(e=Ne()),a.type==="drop"&&(e=et()),a.type==="near"&&(e=tt(a,l,o,n)),a.type==="variable"&&(e=at(a,l,o,n)),a.type==="calc"&&(e=lt(a,l,o,n)),a.type==="say"&&(e=nt(a,l,o,n)),a.type==="hear"&&(e=ot(a,l,o,n)),a.type==="foreach"&&(e=it(a,l,o,n)),a.type==="endforeach"&&(e="Endforeach"),e||(e=JSON.stringify(a)),a.type==="endif"&&(t-=20),a.type==="endforeach"&&(t-=20),e=c("span",{children:[l,": ",i("span",{style:{paddingLeft:t},children:e}),i(le,{size:"small",onMouseDown:()=>{const r=[...o],s=r[l];r.splice(l,1),s.type==="if"&&r.splice(r.findIndex(w=>w.type==="endif"&&w.ifId===s.id),1),s.type==="endif"&&r.splice(r.findIndex(w=>w.type==="if"&&w.id===s.ifId),1),s.type==="foreach"&&r.splice(r.findIndex(w=>w.type==="endforeach"&&w.foreachId===s.id),1),s.type==="endforeach"&&r.splice(r.findIndex(w=>w.type==="foreach"&&w.id===s.foreachId),1),n(r)},children:i(ze,{fontSize:"small"})})]},l),a.type==="if"&&(t+=20),a.type==="foreach"&&(t+=20),{result:e,intend:t}}const st=De(({children:a})=>i("div",{children:a})),pt=Me(({children:a})=>i("div",{children:a}));function dt(a){const[l,o]=$.exports.useState(a.level),[n,t]=$.exports.useState(a.level.characters),[e,r]=$.exports.useState(a.level.code),s=f=>{window.localStorage.setItem(`level${a.levelNumber}`,JSON.stringify(f)),r(f)},[w,X]=$.exports.useState(!1),[H,Y]=$.exports.useState(-1),[u,h]=$.exports.useState(1e3);$.exports.useEffect(()=>{o(a.level),t(a.level.characters),window.localStorage.getItem(`level${a.levelNumber}`)?r(JSON.parse(window.localStorage.getItem(`level${a.levelNumber}`))):s(a.level.code)},[a.level]),$.exports.useEffect(()=>{if(!w)return;const f=setInterval(()=>Y(m=>m+1),u);return()=>clearInterval(f)},[u,w]),$.exports.useEffect(()=>{if(H===-1)return;const f=d(n),m=d(l),S=[];f.forEach((p,I)=>{var W,L,F,q;if(S[I]=p.coordinates,p.terminated||(p.step++,p.step===-1))return;const y=e[p.step];if(!y)return;const j=P(p.coordinates);if(y.type==="step"){const b=Ve(y.destination.directions),v=J(j,b),k=l.cells[v.join("x")];k&&["empty","hole"].includes(k.type)&&(S[I]=v.join("x"))}else y.type==="goto"?p.step=y.step-1:y.type==="pickup"?!p.item&&((W=m.cells[p.coordinates].item)==null?void 0:W.type)==="box"&&(p.item=m.cells[p.coordinates].item,delete m.cells[p.coordinates].item):y.type==="drop"&&((L=p.item)==null?void 0:L.type)==="box"&&!m.cells[p.coordinates].item&&(m.cells[p.coordinates].item=p.item,delete p.item);if(y.type==="take"){const b=J(j,y.direction.value).join("x");!p.item&&((F=m.cells[b])==null?void 0:F.type)==="printer"&&(p.item={type:"box",value:we(0,99)},m.cells[b].printed++)}else if(y.type==="give"){const b=J(j,y.direction.value).join("x");p.item&&((q=m.cells[b])==null?void 0:q.type)==="shredder"&&(delete p.item,m.cells[b].shredded++)}else if(y.type==="hear")p.wait=y.text,p.step--;else if(y.type==="say"){if(y.target.type==="direction"){const b=J(j,y.target.value).join("x"),v=f.find(k=>k.coordinates===b);v&&v.wait===y.text&&(v.wait="",v.step++)}y.target.type==="all"&&f.forEach(b=>{b.wait===y.text&&(b.wait="",b.step++)})}else if(y.type!=="foreach"){if(y.type!=="endforeach"){if(y.type!=="calc"){if(y.type!=="variable"){if(y.type!=="near"){if(y.type==="if"){let b=!1;if(y.conditions.forEach(v=>{var ie,re,se,pe,de,ce,ue,ve,ye,he;let k=!1,z,_,Q,V,U;if(v.value1.type==="direction"){const B=J(j,v.value1.value).join("x");z=(re=(ie=n.find(ae=>v.value1.value!=="here"&&ae.coordinates===B))==null?void 0:ie.item)==null?void 0:re.value,z===void 0&&(z=(pe=(se=m.cells[B])==null?void 0:se.item)==null?void 0:pe.value),Q=(de=m.cells[B])==null?void 0:de.type}else v.value1.type==="slot"||v.value1.type==="myitem"&&p.item&&(z=p.item.value,Q=p.item.type);if(v.value2.type==="direction"){const B=J(j,v.value2.value).join("x");_=(ue=(ce=n.find(ae=>v.value2.value!=="here"&&ae.coordinates===B))==null?void 0:ce.item)==null?void 0:ue.value,_===void 0&&(_=(ye=(ve=m.cells[B])==null?void 0:ve.item)==null?void 0:ye.value),V=(he=m.cells[B])==null?void 0:he.type,k=z===_}else v.value2.type==="slot"||(v.value2.type==="myitem"?(p.item&&(_=p.item.value,V=p.item.type),U="number"):v.value2.type==="number"?(_=v.value2.value,U="number"):(V=v.value2.type,k=Q===V,U="type"));U==="number"&&(v.operation==="=="&&(k=z===_),v.operation==="!="&&(k=z!==_),v.operation===">"&&(k=z>_),v.operation==="<"&&(k=z<_),v.operation==="<="&&(k=z<=_),v.operation===">="&&(k=z>=_)),U==="type"&&(v.operation==="=="&&(k=Q===V),v.operation==="!="&&(k=Q!==V)),v.logic==="OR"?b=b||k:b=b&&k}),!b){let v=0;for(v=p.step;v<e.length&&e[v].type!=="endif";v++);p.step=v}}}}}}}}),f.forEach((p,I)=>{!e[p.step]||(!n.find(j=>j.coordinates===S[I])||n.find((j,W)=>j.coordinates===S[I]&&p.coordinates===S[W])?(p.coordinates=S[I],l.cells[p.coordinates].type==="hole"&&(p.terminated=!0)):e[p.step].type==="step"&&p.step--)});const R=[];f.forEach((p,I)=>{var j;const y=e[p.step];if(!!y&&!R.includes(p.name)&&y.type==="give"&&((j=p.item)==null?void 0:j.type)==="box"){const W=J(P(p.coordinates),y.direction.value),L=f.find(q=>q.coordinates===W.join("x")),F=L?e[L.step]:null;if(L)if(!L.item)L.item=p.item,delete p.item,R.push(L.name);else if(L.item&&(F==null?void 0:F.type)==="give"&&J(P(L.coordinates),F.direction.value).join("x")===p.coordinates){const q=p.item;p.item=L.item,L.item=q,R.push(L.name)}else p.step--}}),t(f),o(m)},[H]);let O=0;const G=$.exports.useMemo(()=>e.map((f,m)=>{const S=rt(f,m,e,s,O);return O=S.intend,S.result}),[e]);return c(N,{container:!0,children:[c(N,{item:!0,md:6,children:[i("h2",{children:l.task}),i("h4",{children:w&&a.level.win(l.cells,n)?"Win":null}),i(be,{cells:l.cells,characters:n,width:l.width,height:l.height,run:w,speed:u})]}),i(N,{item:!0,md:1,children:i(Qe,{code:e,setCode:s})}),i(N,{item:!0,md:5,children:c("div",{style:{paddingLeft:20},children:[i(pt,{onSortEnd:({oldIndex:f,newIndex:m},S)=>{if(S.ctrlKey){const R=d(e);R.splice(m,0,e[f]),s(R)}else{const R=Ae(e,f,m),p=[];if(R.forEach(I=>{I.type==="if"&&p.push(I.id),I.type==="endif"&&p[p.length-1]===I.ifId&&p.splice(p.indexOf(I.ifId),1),I.type==="foreach"&&p.push(I.id),I.type==="endforeach"&&p[p.length-1]===I.foreachId&&p.splice(p.indexOf(I.foreachId),1)}),p.length)return;s(R)}},children:e.map((f,m)=>c(st,{index:m,children:[n.filter(R=>R.step===m).map(R=>i("span",{children:i(K,{fontSize:"small",style:{color:R.color}})},R.name)),G[m]]},m))}),c("div",{style:{paddingTop:20},children:["Speed:"," ",i("input",{type:"number",value:1e3/u,onChange:f=>h(1e3/(parseInt(f.target.value)||1))})]}),i("div",{children:i(A,{onClick:()=>{const f=d(a.level);w||Object.values(f.cells).forEach(m=>{var S;((S=m.item)==null?void 0:S.isRandom)&&(m.item.value=we(0,99))}),o(f),t(a.level.characters),X(!w)},disabled:O!==0,children:w?"Stop":"Run"})}),i("div",{children:i(A,{onClick:()=>ee(JSON.stringify(e,null,2)),children:"Copy"})}),i("div",{children:i(A,{onClick:()=>{window.localStorage.setItem(`level${a.levelNumber}`,JSON.stringify(a.level.code)),s(a.level.code)},children:"Clear"})})]})})]})}const ct={task:"Remove two boxes",width:5,height:7,cells:T(`box|1 box|1 empty box|1 empty
empty empty wall box|2 empty
empty empty wall box|3 empty
empty empty empty box|4 empty
empty empty empty box|5 empty
hole hole
hole hole`),characters:[{coordinates:"0x0",name:"first",color:"red",step:-1},{coordinates:"1x0",name:"second",color:"green",step:-1}],code:[],win:(a,l)=>Object.values(a).filter(o=>{var n;return((n=o.item)==null?void 0:n.type)==="box"}).length+l.filter(o=>{var n;return!o.terminated&&((n=o.item)==null?void 0:n.type)==="box"}).length===5},ut={task:"Move boxes",width:5,height:5,cells:T(`box|1 box|1 empty box|1 empty
empty empty wall box|2 empty
empty empty wall box|3 empty
empty empty empty box|4 empty
empty empty empty box|5 empty`),characters:[{coordinates:"0x0",name:"first",color:"red",step:-1},{coordinates:"1x0",name:"second",color:"green",step:-1}],code:[{type:"step",destination:{type:"direction",directions:["left","right","top","bottom"]}},{type:"step",destination:{type:"direction",directions:["left","right","top","bottom"]}},{type:"pickup"},{type:"step",destination:{type:"direction",directions:["left","right","top","bottom"]}},{type:"step",destination:{type:"direction",directions:["left","right","top","bottom"]}},{type:"drop"},{type:"goto",step:0}],win:(a,l)=>Object.values(a).filter(o=>{var n;return((n=o.item)==null?void 0:n.type)==="box"}).length+l.filter(o=>{var n;return((n=o.item)==null?void 0:n.type)==="box"}).length===5},vt={task:"Remove only box with 2",width:5,height:7,cells:T(`empty empty empty empty empty
box|2|tag2 box|1|tag1 wall empty empty
empty empty wall empty empty
empty empty empty empty empty
empty empty empty empty empty
hole hole
hole hole`),characters:[{coordinates:"0x0",name:"first",color:"red",step:-1},{coordinates:"1x0",name:"second",color:"green",step:-1}],code:[{type:"step",destination:{type:"direction",directions:["bottom"]}},{type:"if",conditions:[{value1:{type:"direction",value:"here"},operation:">",value2:{type:"number",value:1},logic:"OR"}],id:"if1"},{type:"pickup"},{type:"endif",ifId:"if1"},{type:"goto",step:0}],win:(a,l)=>(Object.values(a).find(o=>{var n;return((n=o.item)==null?void 0:n.tag)==="tag1"})||l.find(o=>{var n;return((n=o.item)==null?void 0:n.tag)==="tag1"}))&&!(Object.values(a).find(o=>{var n;return((n=o.item)==null?void 0:n.tag)==="tag2"})||l.find(o=>{var n;return!o.terminated&&((n=o.item)==null?void 0:n.tag)==="tag2"}))},yt={task:"Diagonal boxes",width:5,height:7,cells:T(`empty empty empty empty empty
box|1 box|1 box|1 box|1 box|1
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty`),characters:[{coordinates:"1x1",name:"first",color:"red",step:-1},{coordinates:"2x1",name:"second",color:"green",step:-1},{coordinates:"3x1",name:"3",color:"yellow",step:-1},{coordinates:"4x1",name:"4",color:"blue",step:-1}],code:[],win:(a,l)=>[0,1,2,3,4].every(o=>{var n;return((n=a[`${o}x${o+1}`].item)==null?void 0:n.type)==="box"})},ht={task:"Sort numbers",width:5,height:5,cells:T(`empty empty empty empty empty
box|random box|0 box|random box|random box|random
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty`),characters:[{coordinates:"0x1",name:"1",color:"purple",step:-1},{coordinates:"1x1",name:"2",color:"red",step:-1},{coordinates:"2x1",name:"3",color:"green",step:-1},{coordinates:"3x1",name:"4",color:"yellow",step:-1},{coordinates:"4x1",name:"5",color:"blue",step:-1}],code:[{type:"pickup"},{type:"if",id:"if1",conditions:[{value1:{type:"direction",value:"right"},operation:"<",value2:{type:"myitem"},logic:"OR"}]},{type:"give",direction:{type:"direction",value:"right"}},{type:"endif",ifId:"if1"},{type:"if",id:"if2",conditions:[{value1:{type:"direction",value:"left"},operation:">",value2:{type:"myitem"},logic:"OR"}]},{type:"give",direction:{type:"direction",value:"left"}},{type:"endif",ifId:"if2"},{type:"goto",step:1}],win:(a,l)=>[0,1,2,3,4].every(o=>{var n,t,e,r;return o===0||((t=(n=Ce(l,`${o}x1`))==null?void 0:n.item)==null?void 0:t.value)>=((r=(e=Ce(l,`${o-1}x1`))==null?void 0:e.item)==null?void 0:r.value)})},mt={task:"Print and shred 10 boxes",width:5,height:5,cells:T(`empty empty empty empty empty
empty empty empty empty empty
empty printer shredder empty empty
empty empty empty empty empty
empty empty empty empty empty`),characters:[{coordinates:"1x1",name:"first",color:"red",step:-1},{coordinates:"2x1",name:"second",color:"green",step:-1}],code:[],win:(a,l)=>a["2x2"].shredded>=10},ft={task:"Print and shred 10 boxes (no move)",width:7,height:5,cells:T(`hole hole hole hole hole hole hole
hole empty empty empty empty empty hole
hole printer hole hole hole shredder hole
hole hole hole hole hole hole hole
hole hole hole hole hole hole hole`),characters:[{coordinates:"1x1",name:"1",color:"purple",step:-1},{coordinates:"2x1",name:"2",color:"red",step:-1},{coordinates:"3x1",name:"3",color:"green",step:-1},{coordinates:"4x1",name:"4",color:"yellow",step:-1},{coordinates:"5x1",name:"5",color:"blue",step:-1}],code:[],win:(a,l)=>a["5x2"].shredded>=10},te=[ct,ut,vt,yt,ht,mt,ft];function gt(a){var H,Y;const[l,o]=$.exports.useState({cells:T("empty"),code:[],characters:[],height:1,width:1,task:"",win:(u,h)=>!1}),[n,t]=$.exports.useState(!1),e=l.cells[n],[r,s]=$.exports.useState(0),w=(u,h)=>{const O=d(l);for(let G=0;G<u;G++)for(let f=0;f<h;f++)O.cells[`${G}x${f}`]||(O.cells[`${G}x${f}`]={type:"nothing"});O.width=u,O.height=h,o(O)},X=`{
        task: ${JSON.stringify(l.task)},
        code: [],
        cells: \`${oe(l.cells)}\`,
        characters: ${JSON.stringify(l.characters,null,2)},
        width: ${l.width},
        height: ${l.height},
        win: ${((H=l.win)==null?void 0:H.toString())||"null"}
    }`;return c("div",{children:[c("div",{children:[i(g,{variant:"standard",value:r,onChange:u=>s(parseInt(u.target.value)),children:te.map((u,h)=>i(x,{value:h,children:u.task},h))}),i(A,{onClick:()=>o(te[r]),children:"Import"})]}),c("div",{children:[i(C,{label:"width",value:l.width,variant:"standard",onChange:u=>w(parseInt(u.target.value),l.height)}),i(C,{label:"height",value:l.height,variant:"standard",onChange:u=>w(l.width,parseInt(u.target.value))}),i(A,{onClick:()=>{const u=d(l);Object.keys(u.cells).forEach(h=>{const O=P(h);(O[0]>u.width-1||O[1]>u.height-1)&&delete u.cells[h]}),o(u)},children:"Crop"})]}),i(be,{cells:l.cells,characters:l.characters,width:l.width,height:l.height,run:!1,speed:0,onClick:u=>t(u)}),c("div",{children:[c("div",{children:[i(A,{onClick:()=>ee(oe(l.cells)),children:"Copy cells"}),i(A,{onClick:()=>ee(JSON.stringify(l.characters,null,2)),children:"Copy characters"}),i(A,{onClick:()=>ee(X),children:"Copy level"})]}),c("pre",{children:[i("div",{children:X}),i("div",{children:oe(l.cells)}),i("div",{children:JSON.stringify(l,(u,h)=>typeof h=="function"?`${h}`:h,2)})]})]}),c(Te,{open:n!==!1,onClose:()=>t(!1),children:[i(Je,{children:n}),c(Fe,{children:[i("div",{children:i(g,{value:e==null?void 0:e.type,onChange:u=>{const h=d(l);h.cells[n].type=u.target.value,o(h)},children:["nothing","empty","printer","shredder","wall"].map(u=>i(x,{value:u,children:u},u))})}),(e==null?void 0:e.type)==="empty"?c("div",{children:["Item:"," ",i(ne,{checked:!!(e==null?void 0:e.item),onChange:u=>{const h=d(l);h.cells[n].item=u.target.checked?{type:"box",value:0}:null,o(h)}})]}):null,(e==null?void 0:e.item)?i("div",{children:i(C,{label:"Item value",value:(Y=e==null?void 0:e.item)==null?void 0:Y.value,variant:"standard",onChange:u=>{const h=d(l);h.cells[n].item.value=parseInt(u.target.value),o(h)}})}):null,(e==null?void 0:e.type)==="empty"?c("div",{children:["Character:"," ",i(ne,{checked:!!l.characters.find(u=>u.coordinates===n),onChange:u=>{const h=d(l);u.target.checked?h.characters.push({color:"green",name:`${h.characters.length+1}`,step:-1,coordinates:n}):h.characters.splice(h.characters.findIndex(O=>O.coordinates===n),1),o(h)}})]}):null]})]})]})}const xt=Be({components:{MuiTextField:{styleOverrides:{root:{width:"50px","& input":{textAlign:"center"}}}},MuiSelect:{styleOverrides:{select:{paddingLeft:"24px"}}}}});function wt(){const[a,l]=$.exports.useState(0),[o,n]=$.exports.useState(!1);return i(Pe,{theme:xt,children:c("div",{className:"App",children:[i("h1",{children:"Open7BH"}),c("div",{children:["Editor:"," ",i(ne,{onChange:t=>n(t.target.checked),checked:o})]}),o?i(gt,{}):c(Z,{children:[i("div",{children:i(g,{variant:"standard",value:a,onChange:t=>l(parseInt(t.target.value)),children:te.map((t,e)=>i(x,{value:e,children:t.task},e))})}),i(dt,{level:te[a],levelNumber:a})]})]})})}const Ct="modulepreload",Ie={},bt="./",It=function(l,o){return!o||o.length===0?l():Promise.all(o.map(n=>{if(n=`${bt}${n}`,n in Ie)return;Ie[n]=!0;const t=n.endsWith(".css"),e=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${e}`))return;const r=document.createElement("link");if(r.rel=t?"stylesheet":Ct,t||(r.as="script",r.crossOrigin=""),r.href=n,document.head.appendChild(r),t)return new Promise((s,w)=>{r.addEventListener("load",s),r.addEventListener("error",w)})})).then(()=>l())},kt=a=>{a&&a instanceof Function&&It(()=>import("./web-vitals.67dce932.js"),[]).then(({getCLS:l,getFID:o,getFCP:n,getLCP:t,getTTFB:e})=>{l(a),o(a),n(a),t(a),e(a)})},St=Ge.createRoot(document.getElementById("root"));St.render(i(We.StrictMode,{children:i(wt,{})}));kt();
