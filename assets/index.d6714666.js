import{v as oe,d as Q,a as X,b as ce,c as he,e as de,f as ue,g as pe,h as me,j as a,i as o,F as V,k as Y,l as M,B as I,S as m,M as v,T as b,m as Z,I as H,n as ve,o as be,p as fe,s as ye,q as ge,r as $,G as F,t as _,D as je,u as Ce,w as xe,C as K,x as Se,y as we,z as Ie,A as ee,E as ke,R as Le}from"./vendor.0a97c372.js";const De=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function l(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(n){if(n.ep)return;n.ep=!0;const s=l(n);fetch(n.href,s)}};De();var p;(function(r){r.Calc="calc",r.Pickup="pickup",r.Drop="drop",r.End="end",r.Foreach="foreach",r.EndForeach="endforeach",r.Give="give",r.Goto="goto",r.Hear="hear",r.If="if",r.EndIf="endif",r.Near="near",r.Say="say",r.Step="step",r.Take="take",r.Variable="variable",r.Write="write"})(p||(p={}));class y{constructor(e){this.level=e,this.id=oe()}prepare(e){}remove(){}}var d;(function(r){r.Up="Up",r.Down="Down",r.Left="Left",r.Right="Right",r.UpLeft="UpLeft",r.UpRight="UpRight",r.DownLeft="DownLeft",r.DownRight="DownRight"})(d||(d={}));var j;(function(r){r.Direction="Direction",r.Slot="Slot",r.Near="Near"})(j||(j={}));class $e extends y{constructor(e){super(e);this.type=j.Direction,this.directions=[d.Down]}setDirection(e){this.type=j.Direction,this.directions=e}setSlot(e){this.type=j.Slot,this.slot=e}prepare(e){if(this.type===j.Direction){const l=Ee(this.directions);e.prepareMove(l)}if(this.type===j.Slot&&e.slots[this.slot].getCellValue()){const l=this.level.findNear([e.cell.x,e.cell.y],t=>t===e.slots[this.slot].getCellValue());console.log(e.slots[this.slot].getCellValue()),console.log(l),l.length>1&&l[1]&&(e.nextMove=l[1])}}execute(e){return this.type===j.Slot&&e.nextMove?e.currentLine:e.currentLine+1}serialize(e){return{type:p.Step,stepType:this.type,directions:this.directions,slot:this.slot,object:e?this:void 0}}}const U=r=>r.split("x").map(e=>parseInt(e)),te=r=>{var n;let e="",l=0,t=0;Object.keys(r).forEach(s=>{const i=U(s);i[0]+1>l&&(l=i[0]+1),i[1]+1>t&&(t=i[1]+1)});for(let s=0;s<t;s++){for(let i=0;i<l;i++){const c=r[`${i}x${s}`];c?c.type!=="empty"?e+=`${c.type} `:((n=c.item)==null?void 0:n.type)==="box"?e+=`box|${c.item.isRandom?"random":c.item.value}|${c.item.tag||""} `:e+="empty ":e+="nothing "}e=`${e.trim()}
`}return e.trim()},Ee=r=>r[Math.floor(Math.random()*r.length)],k=r=>{const l={[d.Left]:Q,[d.Right]:X,[d.Up]:ce,[d.Down]:he,[d.UpLeft]:de,[d.UpRight]:ue,[d.DownLeft]:pe,[d.DownRight]:me}[r];return l?a(l,{fontSize:"small"}):null};class W{constructor(e,l,t,n){this.isRandom=!1,this.value=0,this.tag=null,this.value=e,this.isRandom=l,l&&(this.value=Math.floor(Math.random()*(n-t+1))+t)}setTag(e){this.tag=e}}var f;(function(r){r.Empty="empty",r.Wall="wall",r.Hole="hole",r.Printer="printer",r.Shredder="shredder"})(f||(f={}));class G{constructor(e,l,t){this.character=null,this.item=null,this.isEmpty=!1,this.level=e,this.x=l,this.y=t}getCharacter(){return this.character}setCharacter(e){this.isEmpty&&(e.cell&&(e.cell.character=null),this.character=e,e.cell=this)}getItem(){return this.item}setItem(e){this.item=e}removeItem(){this.item=null}}class re{constructor(e){this.character=e}getNumberValue(){return 0}getCellValue(){}getCharacterValue(){}}class le extends re{constructor(){super(...arguments);this.number=0}setNumber(e){this.number=e}getNumberValue(){return this.number}}class q extends G{constructor(e,l,t,n,s){super(e,l,t);this.isEmpty=!0,this.min=0,this.max=99,this.min=n||0,this.max=s||99}print(){return Math.floor(Math.random()*(this.max-this.min+1))+this.min}getType(){return f.Printer}}class B extends G{constructor(){super(...arguments);this.isEmpty=!0,this.shredded=0}getType(){return f.Shredder}shred(){this.shredded++}}class se{constructor(e,l){this.color="green",this.item=null,this.isTerminated=!1,this.isDead=!1,this.slots=[],this.currentLine=0,this.cell=e,this.name=l;for(let t=0;t<4;t++)this.slots.push(new le(this))}prepareMove(e){this.nextMove=this.getMoveCell(e,!0)}prepare(){if(this.isTerminated||this.hear)return;const e=this.cell.level.game.code;if(this.currentLine>=e.length)return;e[this.currentLine].prepare(this)}update(){if(this.isTerminated||this.hear)return;const e=this.cell.level.game.code;if(this.currentLine>=e.length)return;const l=e[this.currentLine];this.currentLine=l.execute(this),this.currentLine>=e.length&&(this.isTerminated=!0)}setItem(e){this.item=e}giveItem(e){const l=this.cell.level.getMoveCell(this.cell.x,this.cell.y,e);l&&l.character&&!l.character.item&&this.item&&(l.character.setItem(this.item),this.item=null),l&&l instanceof B&&this.item&&(l.shred(),this.item=null)}take(e){const l=this.cell.level.getMoveCell(this.cell.x,this.cell.y,e);l&&l instanceof q&&!this.item&&(this.item=new W(l.print()))}write(e){this.item&&(this.item.value=e)}pickupItem(){const e=this.cell.getItem();e&&(this.setItem(e),this.cell.removeItem())}dropItem(){this.item&&(this.cell.setItem(this.item),this.item=null)}getMoveCell(e,l=!1){const t=this.cell.level.getMoveCell(this.cell.x,this.cell.y,e);return t&&t.isEmpty&&(l||!t.character)?t:void 0}say(e,l){const t=this.cell.level.getMoveCell(this.cell.x,this.cell.y,l);t&&t.character&&t.character.hear===e&&(t.character.hear=null,t.character.currentLine++)}terminate(){this.isTerminated=!0}die(){this.isDead=!0,this.terminate(),this.cell.character=null}}class P extends G{constructor(){super(...arguments);this.isEmpty=!0}getType(){return f.Empty}}class ne extends G{constructor(){super(...arguments);this.isEmpty=!0}getType(){return f.Hole}}class L{constructor(e){this.cells={},this.game=e}serialize(e){const l={task:this.task,width:this.width,height:this.height,cells:[],winCallback:this.winCallback,object:e?this:void 0};return Object.values(this.cells).forEach(t=>{const n=t.getCharacter();l.cells.push({x:t.x,y:t.y,type:t.getType(),character:n?{name:n.name,color:n.color,coordinates:[t.x,t.y],object:e?n:void 0}:null,item:t.getItem()?{isRandom:t.getItem().isRandom,value:t.getItem().value,tag:t.getItem().tag}:void 0,object:e?t:void 0})}),l}deserialize(e){this.task=e.task,this.width=e.width,this.height=e.height,this.winCallback=e.winCallback,e.cells.forEach(l=>{let t;l.type===f.Empty&&(t=new P(this,l.x,l.y)),l.type===f.Hole&&(t=new ne(this,l.x,l.y)),l.type===f.Printer&&(t=new q(this,l.x,l.y)),l.type===f.Shredder&&(t=new B(this,l.x,l.y)),l.character&&t.setCharacter(new se(t,l.character.name)),l.item&&(t.setItem(new W(l.item.value,l.item.isRandom)),l.item.tag&&(t.getItem().tag=l.item.tag)),this.addCell(l.x,l.y,t)})}addCharacter(e,l,t){this.getCell(l,t).setCharacter(e)}moveCharacters(){const e=this.getCharacters().filter(t=>t.nextMove),l=[...e];for(;l.length;)l.forEach(t=>{const n=t.nextMove;if(n&&!n.character){console.log(t.name,"move to empty"),t.cell.character=null,t.cell=n,n.character=t,l.splice(l.indexOf(t),1),t.nextMove=null;return}if(n&&n.character&&n.character.nextMove&&n.character.nextMove===t.cell){const s=t.cell,i=n.character.cell,c=t,h=n.character;s.character=h,i.character=c,c.cell=i,h.cell=s,l.splice(l.indexOf(t),1),l.splice(l.indexOf(n.character),1),c.nextMove=null,h.nextMove=null;return}n&&n.character&&!n.character.nextMove&&(console.log(t.name,"move to character",n.character.name),l.splice(l.indexOf(t),1),t.nextMove=null)});e.forEach(t=>{t.cell.getType()===f.Hole&&t.die()}),console.log(this.getCharacters().filter(t=>t.nextMove))}addCell(e,l,t){this.cells[`${e}x${l}`]=t}getCell(e,l){return this.cells[`${e}x${l}`]}getMoveCell(e,l,t){if(t===d.Up)return this.getCell(e,l-1);if(t===d.Down)return this.getCell(e,l+1);if(t===d.Left)return this.getCell(e-1,l);if(t===d.Right)return this.getCell(e+1,l);if(t===d.UpLeft)return this.getCell(e-1,l-1);if(t===d.UpRight)return this.getCell(e+1,l-1);if(t===d.DownLeft)return this.getCell(e-1,l+1);if(t===d.DownRight)return this.getCell(e+1,l+1)}getCharacters(){return Object.values(this.cells).map(e=>e.getCharacter()).filter(e=>e!==null)}findNear(e,l){const t=[],n={[`${e[0]}x${e[1]}`]:0};if(this.markNearRecursive(e,l,1,n,t),t.length){t.sort((i,c)=>n[i]-n[c]);const s=this.getPathRecursive(this.cells[t[0]],n);return s.reverse(),s}return[]}getPathRecursive(e,l={},t=[]){if(t.push(e),l[`${e.x}x${e.y}`]===0)return t;for(const n in Object.values(d)){const s=Object.values(d)[n],i=this.getMoveCell(e.x,e.y,s);if(i&&l[`${i.x}x${i.y}`]===l[`${e.x}x${e.y}`]-1)return this.getPathRecursive(i,l,t)}return t}markNearRecursive(e,l,t,n={},s=[]){if(this.cells[`${e[0]}x${e[1]}`])for(const i in Object.values(d)){const c=Object.values(d)[i],h=this.getMoveCell(e[0],e[1],c);if(!!h&&!(h.getType()!==f.Empty&&!l(h))&&!(n[`${h.x}x${h.y}`]!==void 0&&n[`${h.x}x${h.y}`]<=t)){if(n[`${h.x}x${h.y}`]=t,h&&l(h)){s.push(`${h.x}x${h.y}`);return}this.markNearRecursive([h.x,h.y],l,t+1,n,s)}}}changeSize(e,l){for(let t=0;t<e;t++)for(let n=0;n<l;n++)this.cells[`${t}x${n}`]||(this.cells[`${t}x${n}`]=new P(this,t,n));this.width=e,this.height=l}crop(e,l){Object.keys(this.cells).forEach(t=>{const n=t.split("x");(parseInt(n[0])>=e||parseInt(n[1])>=l)&&delete this.cells[t]}),this.width=e,this.height=l}}L.parseCells=(r,e)=>{const l=[];return r.split(/[\r\n]+/).forEach((t,n)=>{t.split(/ +/).forEach((s,i)=>{const c=s.split("|"),h={type:f.Empty,x:i,y:n,character:void 0};c[0]==="box"&&(h.item={value:parseInt(c[1]),isRandom:c[1]==="random"}),c[0]==="hole"&&(h.type=f.Hole),c[0]==="printer"&&(h.type=f.Printer),c[0]==="shredder"&&(h.type=f.Shredder);const D=e.find(u=>u.coordinates[0]===i&&u.coordinates[1]===n);D&&(h.character=D),l.push(h)})}),l};class Ne extends y{execute(e){return e.dropItem(),e.currentLine+1}serialize(e){return{type:p.Drop,object:e?this:void 0}}}class Oe extends y{execute(e){return e.terminate(),e.currentLine}serialize(e){return{type:p.End,object:e?this:void 0}}}class Re extends y{execute(e){return e.currentLine+1}serialize(e){return{type:p.EndForeach,operatorEndForeach:this.operatorForeach.id,object:e?this:void 0}}}class ze extends y{constructor(){super(...arguments);this.directions=[],this.slotNumber=0}execute(e){return e.currentLine+1}createEndForeach(){const e=new Re(this.level);return e.operatorForeach=this,this.operatorEndForeach=e,e}setDirections(e){this.directions=e}serialize(e){return{type:p.Foreach,operatorEndForeach:this.operatorEndForeach.id,directions:this.directions,slotNumber:this.slotNumber,object:e?this:void 0}}}class Me extends y{constructor(e){super(e);this.direction=d.Down}setDirection(e){this.direction=e}execute(e){return e.giveItem(this.direction),e.currentLine+1}serialize(e){return{type:p.Give,direction:this.direction,slot:this.slot,object:e?this:void 0}}}class Te extends y{constructor(){super(...arguments);this.line=0}execute(e){return this.line}setLine(e){this.line=e}serialize(e){return{type:p.Goto,line:this.line,object:e?this:void 0}}}class Ve extends y{execute(e){return e.hear=this.hear,e.currentLine+1}setHear(e){this.hear=e}serialize(e){return{type:p.Hear,hear:this.hear,object:e?this:void 0}}}class Fe extends y{remove(){const e=this.level.game.code.findIndex(l=>l===this.operatorIf);this.level.game.code.splice(e,1)}execute(e){return e.currentLine+1}serialize(e){return{type:p.EndIf,operatorIf:this.operatorIf.id,object:e?this:void 0}}}var C;(function(r){r.Eq="eq",r.Ne="ne",r.Gt="gt",r.Ge="ge",r.Lt="lt",r.Le="le"})(C||(C={}));var R;(function(r){r.And="and",r.Or="or"})(R||(R={}));var x;(function(r){r.Direction="direction",r.Number="number",r.Slot="slot",r.MyItem="myItem"})(x||(x={}));var E;(function(r){r.Direction="direction",r.Number="number",r.Slot="slot",r.MyItem="myItem"})(E||(E={}));class _e extends y{constructor(e){super(e);this.conditions=[],this.conditions.push({type:C.Eq,leftType:x.Number,leftNumber:0,leftSlot:null,rightType:E.Number,rightNumber:0,rightSlot:null,logic:R.Or})}checkCondition(e){let l=!1;return this.conditions.forEach(t=>{var c,h,D,u;let n=!1,s=0,i=0;switch(t.leftType===x.Number?s=t.leftNumber:t.leftType===x.Slot?s=e.slots[t.leftSlot].getNumberValue():t.leftType===x.MyItem?s=((c=e.item)==null?void 0:c.value)||0:t.leftType===x.Direction&&(s=((h=this.level.getMoveCell(e.cell.x,e.cell.y,t.leftDirection).item)==null?void 0:h.value)||0),t.rightType===E.Number?i=t.rightNumber:t.rightType===E.Slot?i=e.slots[t.rightSlot].getNumberValue():t.rightType===E.MyItem?i=((D=e.item)==null?void 0:D.value)||0:t.rightType===E.Direction&&(i=((u=this.level.getMoveCell(e.cell.x,e.cell.y,t.rightDirection).item)==null?void 0:u.value)||0),t.type){case C.Eq:n=s===i;break;case C.Ne:n=s!==i;break;case C.Gt:n=s>i;break;case C.Ge:n=s>=i;break;case C.Lt:n=s<i;break;case C.Le:n=s<=i;break}t.logic===R.And?l=l&&n:t.logic===R.Or&&(l=l||n)}),l}remove(){const e=this.level.game.code.findIndex(l=>l===this.operatorEndIf);this.level.game.code.splice(e,1)}execute(e){return this.checkCondition(e)?e.currentLine+1:this.level.game.code.findIndex(l=>l===this.operatorEndIf)+1}createEndIf(){const e=new Fe(this.level);return e.operatorIf=this,this.operatorEndIf=e,e}serialize(e){return{type:p.If,conditions:this.conditions,operatorEndIf:this.operatorEndIf.id,object:e?this:void 0}}}class Ge extends re{setCell(e){this.cellValue=e}getCellValue(){return this.cellValue}}var z;(function(r){r.Printer="printer",r.Shredder="shredder",r.Hole="hole",r.Empty="empty"})(z||(z={}));class Pe extends y{constructor(){super(...arguments);this.slot=0,this.nearType=z.Printer,this.numberValue=0,this.slotValue=0}execute(e){const l=this.level.findNear([e.cell.x,e.cell.y],n=>n.getType()===this.nearType);let t=l[l.length-1];return(this.nearType===z.Printer||this.nearType===z.Shredder)&&(t=this.level.getMoveCell(t.x,t.y,d.Up)),e.slots[this.slot]=new Ge(e),e.slots[this.slot].setCell(t),e.currentLine+1}setSlot(e){this.slot=e}setNearType(e){this.nearType=e}serialize(e){return{type:p.Near,slot:this.slot,nearType:this.nearType,object:e?this:void 0}}}class Ae extends y{execute(e){return e.pickupItem(),e.currentLine+1}serialize(e){return{type:p.Pickup,object:e?this:void 0}}}class He extends y{execute(e){return e.say(this.hear,this.direction),e.currentLine+1}setSay(e){this.hear=e}setDirection(e){this.direction=e}serialize(e){return{type:p.Say,hear:this.hear,direction:this.direction,object:e?this:void 0}}}class Ue extends y{constructor(e){super(e);this.direction=d.Down}setDirection(e){this.direction=e}execute(e){return e.take(this.direction),e.currentLine+1}serialize(e){return{type:p.Take,direction:this.direction,object:e?this:void 0}}}var N;(function(r){r.Number="number",r.Slot="slot",r.MyItem="myItem"})(N||(N={}));class We extends y{constructor(){super(...arguments);this.slot=0,this.variableType=N.Number,this.numberValue=0,this.slotValue=0}execute(e){return this.variableType===N.Number&&(e.slots[this.slotValue]=new le(e),e.slots[this.slotValue].setNumber(this.numberValue)),e.currentLine+1}setSlot(e){this.slot=e}setNumberValue(e){this.variableType=N.Number,this.numberValue=e}setSlotValue(e){this.variableType=N.Slot,this.slotValue=e}setMyItemValue(){this.variableType=N.MyItem}serialize(e){return{type:p.Variable,slot:this.slot,variableType:this.variableType,numberValue:this.numberValue,slotValue:this.slotValue,object:e?this:void 0}}}class qe extends y{constructor(){super(...arguments);this.value=0}execute(e){return e.write(this.value),e.currentLine+1}setLine(e){this.value=e}serialize(e){return{type:p.Write,value:this.value,object:e?this:void 0}}}var S;(function(r){r.Run="Run",r.Stop="Stop"})(S||(S={}));class J{constructor(){this.code=[],this.state=S.Stop,this.speed=1e3}getLevel(){return this.level}setLevel(e){this.level=e}addOperator(e,l){let t;e===p.Pickup&&(t=new Ae(this.level)),e===p.Drop&&(t=new Ne(this.level)),e===p.End&&(t=new Oe(this.level)),e===p.Goto&&(t=new Te(this.level)),e===p.Hear&&(t=new Ve(this.level)),e===p.If&&(t=new _e(this.level),this.code.splice(l,0,t.createEndIf())),e===p.Say&&(t=new He(this.level)),e===p.Step&&(t=new $e(this.level)),e===p.Take&&(t=new Ue(this.level)),e===p.Variable&&(t=new We(this.level)),e===p.Write&&(t=new qe(this.level)),e===p.Foreach&&(t=new ze(this.level),this.code.splice(l,0,t.createEndForeach())),e===p.Give&&(t=new Me(this.level)),e===p.Near&&(t=new Pe(this.level)),t&&this.code.splice(l,0,t)}removeOperator(e){const l=this.code[e];this.code.splice(e,1),l.remove()}start(){this.state=S.Run,this.interval=window.setInterval(()=>{this.state===S.Run&&this.update()},this.speed)}stop(){clearInterval(this.interval),this.state=S.Stop}update(){!this.level.getCharacters().filter(e=>!e.isTerminated).length||(this.level.getCharacters().forEach(e=>{e.prepare()}),this.level.getCharacters().forEach(e=>{e.update()}),this.level.moveCharacters(),this.level.winCallback(this.level),this.level.getCharacters().length<2&&console.log("Wrong character"),console.log(this.level.cells),this.render())}deserialize(e){this.level||(this.level=new L(this)),this.level.deserialize(e.level)}serialize(e=!1){return{level:this.level.serialize(e),code:this.code.map(l=>l.serialize(e)),state:this.state,speed:this.speed,object:e?this:void 0}}moveOperator(e,l){if(!this.code[e]||!this.code[l])return;const t=this.code[e];this.code.splice(e,1),this.code.splice(l,0,t)}render(){console.log("render"),this.renderCallback(this.serialize(!0))}}const w=80;function ae(r){const e=r.game.object.level.cells,l=Object.keys(e).map(n=>{const s=U(n),i=e[n];let c;return i instanceof P&&(c=null,i.getItem()&&(c=o(V,{children:[a(Y,{fontSize:"small"})," ",i.item.isRandom&&r.game.state!==S.Run?"?":i.item.value]}))),i instanceof ne&&(c=a("div",{style:{width:"100%",height:"100%",backgroundColor:"black"}})),i instanceof q&&(c="printer"),i instanceof B&&(c="shredder"),a("div",{onClick:()=>r.onClick(n),style:{position:"absolute",left:s[0]*w,top:s[1]*w,width:w,height:w,borderStyle:"solid",borderColor:"black",borderWidth:1,display:"flex",alignItems:"center",justifyContent:"center"},children:c},n)}),t=r.game.object.level.getCharacters().sort((n,s)=>n.name>s.name?1:-1).map(n=>{const s=[n.cell.x,n.cell.y];return o("div",{style:{position:"absolute",opacity:n.isDead?0:1,transform:`translate(${s[0]*w}px, ${s[1]*w+10}px)`,transition:`all ${r.game.speed}ms ease-in`},children:[a(M,{fontSize:"small",style:{color:n.color}}),n.item?o(V,{children:["(",a(Y,{fontSize:"small"})," ",n.item.value,")"]}):null]},n.name)});return o("div",{style:{position:"relative",width:r.game.level.width*w+w/2,height:r.game.level.height*w+w/2},children:[l,t]})}function Be(r){return a(V,{children:Object.values(p).map(e=>a("div",{children:a(I,{onClick:()=>{r.game.object.addOperator(e,0),r.game.object.render()},children:`Add ${e}`})},e))})}const Je=(r,e,l)=>o("span",{children:["Step:"," ",a(m,{IconComponent:null,value:r.object.type,onChange:t=>{t.target.value===j.Direction&&(r.object.setDirection([d.Down]),l.object.render()),t.target.value===j.Slot&&(r.object.setSlot(0),l.object.render())},variant:"standard",children:Object.values(j).map(t=>a(v,{value:t,children:t},t))}),r.object.type===j.Direction&&a(m,{IconComponent:null,value:r.object.directions,variant:"standard",multiple:!0,onChange:t=>{r.object.setDirection(t.target.value),l.object.render()},children:Object.values(d).map(t=>o(v,{value:t,children:[k(t),t]},t))}),r.object.type===j.Slot&&a(b,{type:"number",value:r.slot,variant:"standard",onChange:t=>{r.object.setSlot(parseInt(t.target.value)||0),l.object.render()}})]}),Qe=(r,e,l)=>o("span",{children:["Give:"," ",a(M,{fontSize:"small"}),a(X,{fontSize:"small"}),a(Z,{fontSize:"small"})," ",a(m,{IconComponent:null,value:r.direction,variant:"standard",onChange:t=>{r.object.setDirection(t.target.value),l.object.render()},children:Object.values(d).map(t=>o(v,{value:t,children:[k(t),t]},t))})]}),Xe=(r,e,l)=>o("span",{children:["Take"," ",a(M,{fontSize:"small"}),a(Q,{fontSize:"small"}),a(Z,{fontSize:"small"})," ",a(m,{IconComponent:null,value:r.direction,variant:"standard",onChange:t=>{r.object.setDirection(t.target.value),l.object.render()},children:Object.values(d).map(t=>o(v,{value:t,children:[k(t),t]},t))})]}),Ye=(r,e,l)=>o("span",{children:["Goto:"," ",a(m,{IconComponent:null,value:r.line,variant:"standard",onChange:t=>{r.object.setLine(parseInt(t.target.value.toString())),l.object.render()},children:Object.keys(l.code).map(t=>a(v,{value:t,children:t},t))})]}),Ze=(r,e,l)=>o("span",{children:["If:"," ",r.conditions.map((t,n)=>o("span",{children:[!!n&&a(m,{IconComponent:null,value:t.logic,variant:"standard",onChange:s=>{r.object.conditions[n].logic=s.target.value,l.object.render()},children:Object.values(R).map(s=>a(v,{value:s,children:s},s))}),a(m,{IconComponent:null,value:t.leftType,onChange:s=>{r.object.conditions[n].leftType=s.target.value,l.object.render()},variant:"standard",children:Object.values(x).map(s=>a(v,{value:s,children:s},s))}),t.leftType==="direction"&&a(m,{IconComponent:null,value:t.leftDirection,variant:"standard",onChange:s=>{r.object.conditions[n].leftDirection=s.target.value,l.object.render()},children:Object.values(d).map(s=>o(v,{value:s,children:[k(s),s]},s))}),t.leftType==="slot"&&a(b,{type:"number",value:t.leftSlot,variant:"standard",onChange:s=>{r.object.conditions[n].leftSlot=parseInt(s.target.value)||0,l.object.render()}}),a(m,{IconComponent:null,value:t.type,variant:"standard",onChange:s=>{r.object.conditions[n].type=s.target.value,l.object.render()},children:Object.values(C).map(s=>a(v,{value:s,children:s},s))}),a(m,{IconComponent:null,value:t.rightType,onChange:s=>{r.object.conditions[n].rightType=s.target.value,l.object.render()},variant:"standard",children:Object.values(x).map(s=>a(v,{value:s,children:s},s))}),t.rightType==="number"&&a(b,{type:"number",value:t.rightNumber,variant:"standard",onChange:s=>{r.object.conditions[n].rightNumber=parseInt(s.target.value)||0,l.object.render()}}),t.rightType==="direction"&&a(m,{IconComponent:null,value:t.rightDirection,variant:"standard",onChange:s=>{r.object.conditions[n].rightDirection=s.target.value,l.object.render()},children:Object.values(d).map(s=>o(v,{value:s,children:[k(s),s]},s))}),t.rightType==="slot"&&a(b,{type:"number",value:t.rightSlot,variant:"standard",onChange:s=>{r.object.conditions[n].rightSlot=parseInt(s.target.value)||0}}),a(H,{size:"small",onMouseDown:()=>{const s=r.object.conditions;s.splice(n,1),r.object.conditions=s,l.object.render()},children:a(ve,{})}),n===r.conditions.length-1&&a(H,{size:"small",onMouseDown:()=>{r.object.conditions.push({logic:R.And,leftType:x.Slot,leftSlot:0,type:C.Eq,rightType:E.Number,rightSlot:0}),l.object.render()},children:a(be,{})})]},n))]}),Ke=()=>"Pickup",et=()=>"Drop",tt=(r,e,l)=>o("span",{children:["Near:"," ","slot",a(b,{type:"number",value:r.slot,variant:"standard",onChange:t=>{r.object.setSlot(parseInt(t.target.value)||0),l.object.render()}}),"=",a(m,{IconComponent:null,value:r.nearType,onChange:t=>{r.object.setNearType(t.target.value),l.object.render()},variant:"standard",children:Object.values(z).map(t=>a(v,{value:t,children:t},t))})]}),rt=(r,e,l)=>o("span",{children:["Variable"," ","slot",a(b,{type:"number",value:r.slot,variant:"standard",onChange:t=>{r.object.setSlot(parseInt(t.target.value)||0),l.object.render()}}),"=",a(m,{IconComponent:null,value:r.variableType,onChange:t=>{t.target.value==="number"&&r.object.setNumberValue(0),t.target.value==="myitem"&&r.object.setMyItemValue(),t.target.value==="slot"&&r.object.setSlotValue(0)},variant:"standard",children:Object.values(N).map(t=>a(v,{value:t,children:t},t))}),r.variableType==="number"&&a(b,{type:"number",value:r.numberValue,variant:"standard",onChange:t=>{r.object.setNumberValue(parseInt(t.target.value)||0),l.object.render()}}),r.variableType==="slot"&&a(b,{type:"number",value:r.slotValue,variant:"standard",onChange:t=>{r.object.setSlotValue(parseInt(t.target.value)||0),l.object.render()}})]});var A;(function(r){r.Add="+",r.Subtract="-",r.Multiply="*",r.Divide="/"})(A||(A={}));var O;(function(r){r.Number="number",r.Direction="direction",r.Slot="slot"})(O||(O={}));const lt=(r,e,l)=>o("span",{children:["Calc"," ","slot",a(b,{type:"number",value:r.slotResult,variant:"standard",onChange:t=>{r.object.slotResult=parseInt(t.target.value)||0,l.object.render()}}),"=",a(m,{IconComponent:null,value:r.operand1type,onChange:t=>{t.target.value==="number"&&r.object.setOperand1Number(0),t.target.value==="direction"&&r.object.setOperand1Direction(d.Up),t.target.value==="slot"&&r.object.setOperand1Slot(0),l.object.render()},variant:"standard",children:Object.values(A).map(t=>a(v,{value:t,children:t},t))}),r.operand1type===O.Number&&a(b,{type:"number",value:r.operand1NumberValue,variant:"standard",onChange:t=>{r.object.setOperand1Number(parseInt(t.target.value)||0),l.object.render()}}),r.operand1type===O.Direction&&a(m,{IconComponent:null,value:r.operand1DirectionValue,variant:"standard",onChange:t=>{r.object.setOperand1Direction(t.target.value),l.object.render()},children:Object.values(d).map(t=>o(v,{value:t,children:[k(t),t]},t))}),r.operand1type===O.Slot&&a(b,{type:"number",value:r.operand1SlotValue,variant:"standard",onChange:t=>{r.object.setOperand1Slot(parseInt(t.target.value)||0),l.object.render()}}),a(m,{IconComponent:null,value:r.operator,variant:"standard",onChange:t=>{r.operator=t.target.value},children:Object.values(A).map(t=>a(v,{value:t,children:t},t))}),a(m,{IconComponent:null,value:r.operand2type,onChange:t=>{t.target.value==="number"&&r.object.setOperand2Number(0),t.target.value==="direction"&&r.object.setOperand2Direction(d.Up),t.target.value==="slot"&&r.object.setOperand2Slot(0),l.object.render()},variant:"standard",children:["number","direction","slot","myitem"].map(t=>a(v,{value:t,children:t},t))}),r.operand2type===O.Number&&a(b,{type:"number",value:r.operand2NumberValue,variant:"standard",onChange:t=>{r.object.setOperand2Number(parseInt(t.target.value)||0),l.object.render()}}),r.operand2type===O.Direction&&a(m,{IconComponent:null,value:r.operand2DirectionValue,variant:"standard",onChange:t=>{r.object.setOperand2Direction(t.target.value),l.object.render()},children:Object.values(d).map(t=>o(v,{value:t,children:[k(t),t]},t))}),r.operand2type===O.Slot&&a(b,{type:"number",value:r.operand2SlotValue,variant:"standard",onChange:t=>{r.object.setOperand2Slot(parseInt(t.target.value)||0),l.object.render()}})]}),st=(r,e,l)=>o("span",{children:["Say:"," ",a(b,{value:r.hear,variant:"standard",onChange:t=>{r.object.setSay(t.target.value),l.object.render()}}),a(m,{IconComponent:null,value:r.direction,variant:"standard",onChange:t=>{r.object.setDirection(t.target.value),l.object.render()},children:Object.values(d).map(t=>o(v,{value:t,children:[k(t),t]},t))})]}),nt=(r,e,l)=>o("span",{children:["Hear:"," ",a(b,{value:r.hear,variant:"standard",onChange:t=>{r.object.hear=t.target.value,l.object.render()}})]}),at=(r,e,l)=>o("span",{children:["Foreach:"," ",a(m,{IconComponent:null,value:r.directions,variant:"standard",multiple:!0,onChange:t=>{r.object.setDirections(t.target.value),l.object.render()},children:Object.values(d).map(t=>o(v,{value:t,children:[k(t),t]},t))}),a(b,{type:"number",value:r.slotNumber,variant:"standard",onChange:t=>{r.object.slotNumber=parseInt(t.target.value)||0,l.object.render()}})]}),it=()=>"End",ot=(r,e,l)=>o("span",{children:["Write"," ",a(b,{type:"number",value:r.value,variant:"standard",onChange:t=>{r.object.value=parseInt(t.target.value)||0,l.object.render()}})]});function ct(r,e,l,t){let n=null;return r.type==="step"&&(n=Je(r,e,l)),r.type==="give"&&(n=Qe(r,e,l)),r.type==="take"&&(n=Xe(r,e,l)),r.type==="goto"&&(n=Ye(r,e,l)),r.type==="if"&&(n=Ze(r,e,l)),r.type==="endif"&&(n="Endif"),r.type==="pickup"&&(n=Ke()),r.type==="drop"&&(n=et()),r.type==="near"&&(n=tt(r,e,l)),r.type==="variable"&&(n=rt(r,e,l)),r.type==="calc"&&(n=lt(r,e,l)),r.type==="say"&&(n=st(r,e,l)),r.type==="hear"&&(n=nt(r,e,l)),r.type==="foreach"&&(n=at(r,e,l)),r.type==="endforeach"&&(n="Endforeach"),r.type==="end"&&(n=it()),r.type==="write"&&(n=ot(r,e,l)),r.type==="endif"&&(t-=20),r.type==="endforeach"&&(t-=20),n=o("span",{children:[e,": ",a("span",{style:{paddingLeft:t},children:n}),a(H,{size:"small",onMouseDown:()=>{l.object.removeOperator(e),l.object.render()},children:a(fe,{fontSize:"small"})})]},e),r.type==="if"&&(t+=20),r.type==="foreach"&&(t+=20),{result:n,intend:t}}const ht=ye(({children:r})=>a("div",{children:r})),dt=ge(({children:r})=>a("div",{children:r}));function ut(r){const[e,l]=$.exports.useState();$.exports.useEffect(()=>{const s=new J;s.deserialize({level:r.level}),s.renderCallback=l,s.render()},[r.level]);let t=0;const n=$.exports.useMemo(()=>e?e.code.map((s,i)=>{const c=ct(s,i,e,t);return t=c.intend,c.result}):[],[e==null?void 0:e.code]);return e?o(F,{container:!0,children:[o(F,{item:!0,md:6,children:[a("h2",{children:e.level.task}),a("h4",{children:e.state===S.Run&&e.level.winCallback(e.level.object)?"Win":null}),a(ae,{game:e})]}),a(F,{item:!0,md:1,children:a(Be,{game:e})}),a(F,{item:!0,md:5,children:o("div",{style:{paddingLeft:20},children:[a(dt,{onSortEnd:({oldIndex:s,newIndex:i},c)=>{c.ctrlKey||(e.object.moveOperator(s,i),e.object.render())},children:e.code.map((s,i)=>o(ht,{index:i,children:[e.object.level.getCharacters().filter(h=>h.currentLine===i).map(h=>a("span",{children:a(M,{fontSize:"small",style:{color:h.color}})},h.name)),n[i]]},i))}),o("div",{style:{paddingTop:20},children:["Speed:"," ",a(b,{variant:"standard",type:"number",value:1e3/e.speed,onChange:s=>{e.object.speed=1e3/(parseInt(s.target.value)||1),e.object.render()}})]}),o("div",{style:{display:"flex",gap:4},children:[a("div",{children:a(I,{variant:"contained",onClick:()=>{e.object.deserialize({level:r.level}),e.object.render(),e.object.state===S.Run?e.object.stop():e.object.start()},disabled:t!==0,children:e.object.state===S.Run?"Stop":"Run"})}),a("div",{children:a(I,{variant:"contained",onClick:()=>_(JSON.stringify(e.object.serialize(),null,2)),children:"Copy"})}),a("div",{children:a(I,{variant:"contained",onClick:()=>{},children:"Clear"})})]}),e.object.level.getCharacters().map(s=>{var i;return o("div",{children:[s.name," ",a("span",{style:{color:s.color},children:a(M,{fontSize:"small"})})," ",(i=s.slots)==null?void 0:i.map((c,h)=>o("span",{children:[c.getNumberValue()," "]},h))]},s.name)}),a("pre",{children:JSON.stringify(Object.values(e.object.level.cells).filter(s=>s.character).map(s=>{var i;return{name:(i=s.character)==null?void 0:i.name,line:s.character.currentLine,x:s.x,y:s.y}}),null,2)})]})})]}):null}const pt={task:"Remove two boxes",width:5,height:7,cells:L.parseCells(`box|1 box|1 hole box|1 hole
empty empty hole box|2 empty
empty empty hole box|3 empty
empty empty hole box|4 printer
empty empty empty box|5 empty
hole hole
hole hole`,[{coordinates:[0,0],name:"first",color:"red"},{coordinates:[1,0],name:"second",color:"green"}]),winCallback:r=>Object.values(r.cells).filter(e=>e.item).length+r.getCharacters().filter(e=>!e.isDead&&e.item).length===5},mt={task:"Move boxes",width:5,height:5,cells:L.parseCells(`box|1 box|1 empty box|1 empty
        empty empty wall box|2 empty
        empty empty wall box|3 empty
        empty empty empty box|4 empty
        empty empty empty box|5 empty`,[{coordinates:[0,0],name:"first",color:"red"},{coordinates:[1,0],name:"second",color:"green"}]),winCallback:r=>Object.values(r.cells).filter(e=>e.item).length+r.getCharacters().filter(e=>!e.isDead&&e.item).length===5},vt={task:"Remove only box with 2",width:5,height:7,cells:L.parseCells(`empty empty empty empty empty
box|2|tag2 box|1|tag1 wall empty empty
empty empty wall empty empty
empty empty empty empty empty
empty empty empty empty empty
hole hole
hole hole`,[{coordinates:[0,0],name:"first",color:"red"},{coordinates:[1,0],name:"second",color:"green"}]),winCallback:r=>(Object.values(r.cells).find(e=>{var l;return((l=e.item)==null?void 0:l.tag)==="tag1"})||r.getCharacters().find(e=>{var l;return((l=e.item)==null?void 0:l.tag)==="tag1"}))&&!(Object.values(r.cells).find(e=>{var l;return((l=e.item)==null?void 0:l.tag)==="tag2"})||r.getCharacters().find(e=>{var l;return!e.isTerminated&&((l=e.item)==null?void 0:l.tag)==="tag2"}))},bt={task:"Diagonal boxes",width:5,height:7,cells:L.parseCells(`empty empty empty empty empty
box|1 box|1 box|1 box|1 box|1
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty`,[{coordinates:[1,1],name:"first",color:"red"},{coordinates:[2,1],name:"second",color:"green"},{coordinates:[3,1],name:"3",color:"yellow"},{coordinates:[4,1],name:"4",color:"blue"}]),winCallback:r=>[0,1,2,3,4].every(e=>r.cells[`${e}x${e+1}`].item)},ft={task:"Sort numbers",width:5,height:5,cells:L.parseCells(`empty empty empty empty empty
box|random box|0 box|random box|random box|random
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty`,[{coordinates:[0,1],name:"1",color:"purple"},{coordinates:[1,1],name:"2",color:"red"},{coordinates:[2,1],name:"3",color:"green"},{coordinates:[3,1],name:"4",color:"yellow"},{coordinates:[4,1],name:"5",color:"blue"}]),winCallback:r=>[0,1,2,3,4].every(e=>{var l,t,n,s;return e===0||((t=(l=r.cells[`${e}x1`].character)==null?void 0:l.item)==null?void 0:t.value)>=((s=(n=r.cells[`${e-1}x1`].character)==null?void 0:n.item)==null?void 0:s.value)})},yt={task:"Print and shred 10 boxes",width:5,height:5,cells:L.parseCells(`empty empty empty empty empty
empty empty empty empty empty
empty printer shredder empty empty
empty empty empty empty empty
empty empty empty empty empty`,[{coordinates:[1,1],name:"first",color:"red"},{coordinates:[2,1],name:"second",color:"green"}]),winCallback:r=>r.cells["2x2"].shredded>=10},gt={task:"Print and shred 10 boxes (no move)",width:7,height:5,cells:L.parseCells(`hole hole hole hole hole hole hole
hole empty empty empty empty empty hole
hole printer hole hole hole shredder hole
hole hole hole hole hole hole hole
hole hole hole hole hole hole hole`,[{coordinates:[1,1],name:"1",color:"purple"},{coordinates:[2,1],name:"2",color:"red"},{coordinates:[3,1],name:"3",color:"green"},{coordinates:[4,1],name:"4",color:"yellow"},{coordinates:[5,1],name:"5",color:"blue"}]),winCallback:r=>r.cells["5x2"].shredded>=10},T=[pt,mt,vt,bt,ft,yt,gt];function jt(r){var D;const[e,l]=$.exports.useState(()=>{const u=new J;return u.deserialize({level:T[0]}),u.renderCallback=g=>l(g),u.serialize(!0)}),[t,n]=$.exports.useState(!1),s=e.object.level.cells[t],[i,c]=$.exports.useState(0),h=JSON.stringify(e.object.serialize(),null,2);return o("div",{children:[o("div",{children:[a(m,{variant:"standard",value:i,onChange:u=>c(parseInt(u.target.value)),children:T.map((u,g)=>a(v,{value:g,children:u.task},g))}),a(I,{onClick:()=>{const u=new J;u.deserialize({level:T[i]}),u.renderCallback=g=>l(g),u.render()},children:"Import"})]}),o("div",{children:[a(b,{label:"width",value:e.level.width,variant:"standard",onChange:u=>{e.object.level.changeSize(parseInt(u.target.value),e.level.height),e.object.render()}}),a(b,{label:"height",value:e.level.height,variant:"standard",onChange:u=>{e.object.level.changeSize(e.level.width,parseInt(u.target.value)),e.object.render()}}),a(I,{onClick:()=>{e.object.level.crop(e.object.level.width,e.object.level.height),e.object.render()},children:"Crop"})]}),a(ae,{game:e,onClick:u=>n(u)}),o("div",{children:[o("div",{children:[a(I,{onClick:()=>_(te(e.object.level.serialize(!1))),children:"Copy cells"}),a(I,{onClick:()=>_(JSON.stringify(e.object.level.getCharacters(),null,2)),children:"Copy characters"}),a(I,{onClick:()=>_(h),children:"Copy level"})]}),o("pre",{children:[a("div",{children:h}),a("div",{children:te(e.object.level.serialize(!1))}),a("div",{children:JSON.stringify(e.object.serialize(),(u,g)=>typeof g=="function"?`${g}`:g,2)})]})]}),o(je,{open:t!==!1,onClose:()=>n(!1),children:[a(Ce,{children:t}),o(xe,{children:[a("div",{children:a(m,{value:s==null?void 0:s.getType(),onChange:u=>{const g=U(t);e.object.level.addCell(g[0],g[1],new P(e.object.level,g[0],g[1])),e.object.render()},children:Object.values(f).map(u=>a(v,{value:u,children:u},u))})}),(s==null?void 0:s.getType())==="empty"?o("div",{children:["Item:"," ",a(K,{checked:!!(s==null?void 0:s.item),onChange:u=>{u.target.checked?s.setItem(new W(0)):s.setItem(null),e.object.render()}})]}):null,(s==null?void 0:s.item)?a("div",{children:a(b,{label:"Item value",value:(D=s==null?void 0:s.item)==null?void 0:D.value,variant:"standard",onChange:u=>{s.item.value=parseInt(u.target.value)||0,e.object.render()}})}):null,(s==null?void 0:s.getType())==="empty"?o("div",{children:["Character:"," ",a(K,{checked:!!s.character,onChange:u=>{u.target.checked?(s.setCharacter(new se(s,`${e.object.level.getCharacters().length+1}`)),s.character.color="green"):s.character=null,e.object.render()}})]}):null]})]})]})}const Ct=Se({components:{MuiTextField:{styleOverrides:{root:{width:"50px","& input":{textAlign:"center"}}}},MuiSelect:{styleOverrides:{select:{paddingLeft:"24px"}}}}});function xt(){const[r,e]=$.exports.useState(0),[l,t]=$.exports.useState(!1);return a(we,{theme:Ct,children:o("div",{className:"App",children:[a("h1",{children:"Open7BH"}),o(Ie,{value:l?1:0,onChange:(n,s)=>t(s===1),children:[a(ee,{label:"Game"}),a(ee,{label:"Editor"})]}),l?a(jt,{}):o(V,{children:[a("div",{children:a(m,{variant:"standard",value:r,onChange:n=>e(parseInt(n.target.value)),children:T.map((n,s)=>a(v,{value:s,children:n.task},s))})}),a(ut,{level:T[r],levelNumber:r})]})]})})}const St="modulepreload",ie={},wt="./",It=function(e,l){return!l||l.length===0?e():Promise.all(l.map(t=>{if(t=`${wt}${t}`,t in ie)return;ie[t]=!0;const n=t.endsWith(".css"),s=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${s}`))return;const i=document.createElement("link");if(i.rel=n?"stylesheet":St,n||(i.as="script",i.crossOrigin=""),i.href=t,document.head.appendChild(i),n)return new Promise((c,h)=>{i.addEventListener("load",c),i.addEventListener("error",h)})})).then(()=>e())},kt=r=>{r&&r instanceof Function&&It(()=>import("./web-vitals.67dce932.js"),[]).then(({getCLS:e,getFID:l,getFCP:t,getLCP:n,getTTFB:s})=>{e(r),l(r),t(r),n(r),s(r)})},Lt=ke.createRoot(document.getElementById("root"));Lt.render(a(Le.StrictMode,{children:a(xt,{})}));kt();
