import{v as ze,d as te,a as re,b as ke,c as Ee,e as Te,f as Oe,g as Me,h as Re,j as n,i as u,F as _,k as le,l as U,B as V,S as b,M as g,T as j,m as se,I as Q,n as $e,o as Fe,p as Pe,s as Ue,q as Ge,r as E,G as A,t as W,u as ie,D as He,w as _e,x as Ae,C as ne,y as We,z as qe,A as Be,E as ae,H as Je,R as Qe}from"./vendor.9f07ba41.js";const Xe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function l(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(s){if(s.ep)return;s.ep=!0;const i=l(s);fetch(s.href,i)}};Xe();var o;(function(r){r.Calc="calc",r.Pickup="pickup",r.Drop="drop",r.End="end",r.Foreach="foreach",r.EndForeach="endforeach",r.Give="give",r.Goto="goto",r.Hear="hear",r.If="if",r.EndIf="endif",r.Near="near",r.Say="say",r.Step="step",r.Take="take",r.Variable="variable",r.Write="write"})(o||(o={}));class C{constructor(e){this.level=e,this.id=ze()}prepare(e){}remove(){}postDeserialize(){}}var m;(function(r){r.Up="Up",r.Down="Down",r.Left="Left",r.Right="Right",r.UpLeft="UpLeft",r.UpRight="UpRight",r.DownLeft="DownLeft",r.DownRight="DownRight"})(m||(m={}));var v;(function(r){r.Up="Up",r.Down="Down",r.Left="Left",r.Right="Right",r.UpLeft="UpLeft",r.UpRight="UpRight",r.DownLeft="DownLeft",r.DownRight="DownRight",r.Here="Here"})(v||(v={}));var x;(function(r){r.Direction="Direction",r.Slot="Slot"})(x||(x={}));class oe extends C{constructor(e){super(e);this.type=x.Direction,this.directions=[m.Down]}setDirection(e){this.type=x.Direction,this.directions=e}setSlot(e){this.type=x.Slot,this.slot=e}prepare(e){if(this.type===x.Direction){const l=Ye(this.directions);e.prepareMove(l)}if(this.type===x.Slot&&e.slots[this.slot].getCellValue()){const l=this.level.findNear([e.cell.x,e.cell.y],t=>t===e.slots[this.slot].getCellValue());console.log(e.slots[this.slot].getCellValue()),console.log(l),l.length>1&&l[1]&&(e.nextMove=l[1])}}execute(e){return this.type===x.Slot&&e.nextMove?e.currentLine:e.currentLine+1}serialize(e){return{type:o.Step,stepType:this.type,directions:this.directions,slot:this.slot,object:e?this:void 0}}deserialize(e){this.type=e.stepType,this.directions=e.directions,this.slot=e.slot}}const ce=r=>r.split("x").map(e=>parseInt(e)),Ye=r=>r[Math.floor(Math.random()*r.length)],T=r=>{const l={[v.Left]:te,[v.Right]:re,[v.Up]:ke,[v.Down]:Ee,[v.UpLeft]:Te,[v.UpRight]:Oe,[v.DownLeft]:Me,[v.DownRight]:Re,[v.Here]:null}[r];return l?n(l,{fontSize:"small"}):null};class X{constructor(e,l,t,s){this.isRandom=!1,this.value=0,this.tag=null,this.value=e,this.isRandom=l,l&&(this.value=Math.floor(Math.random()*(s-t+1))+t)}setTag(e){this.tag=e}}var y;(function(r){r.Empty="empty",r.Wall="wall",r.Hole="hole",r.Printer="printer",r.Shredder="shredder"})(y||(y={}));class G{constructor(e,l,t){this.character=null,this.item=null,this.isEmpty=!1,this.level=e,this.x=l,this.y=t}getCharacter(){return this.character}setCharacter(e){this.isEmpty&&(e.cell&&(e.cell.character=null),this.character=e,e.cell=this)}getItem(){return this.item}setItem(e){this.item=e}removeItem(){this.item=null}}class he{constructor(e){this.character=e}getNumberValue(){return 0}getCellValue(){}getCharacterValue(){}}class Y extends he{constructor(){super(...arguments);this.number=0}setNumber(e){this.number=e}getNumberValue(){return this.number}}class q extends G{constructor(e,l,t,s,i){super(e,l,t);this.isEmpty=!0,this.min=0,this.max=99,this.min=s||0,this.max=i||99}print(){return Math.floor(Math.random()*(this.max-this.min+1))+this.min}getType(){return y.Printer}}class B extends G{constructor(){super(...arguments);this.isEmpty=!0,this.shredded=0}getType(){return y.Shredder}shred(){this.shredded++}}class de{constructor(e,l){this.color="green",this.item=null,this.isTerminated=!1,this.isDead=!1,this.slots=[],this.currentLine=0,this.operationDone=!1,this.foreachLoops=[],this.cell=e,this.name=l;for(let t=0;t<4;t++)this.slots.push(new Y(this))}prepareMove(e){this.nextMove=this.getMoveCell(e,!0)}prepare(){if(this.isTerminated||this.hear)return;const e=this.cell.level.game.code;if(this.currentLine>=e.length)return;e[this.currentLine].prepare(this)}update(){if(this.isTerminated)return;if(this.operationDone){this.operationDone=!1;return}if(this.hear)return;const e=this.cell.level.game.code;if(this.currentLine>=e.length)return;const l=e[this.currentLine];this.currentLine=l.execute(this),this.currentLine>=e.length&&(this.isTerminated=!0),this.operationDone=!1}setItem(e){this.item=e}giveItem(e){const l=this.cell.level.getMoveCell(this.cell.x,this.cell.y,e);l&&l.character&&!l.character.item&&this.item&&(l.character.setItem(this.item),l.character.operationDone=!0,this.item=null),l&&l instanceof B&&this.item&&(l.shred(),this.item=null)}take(e){const l=this.cell.level.getMoveCell(this.cell.x,this.cell.y,e);l&&l instanceof q&&!this.item&&(this.item=new X(l.print()))}write(e){this.item&&(this.item.value=e)}pickupItem(){const e=this.cell.getItem();e&&!this.item&&(this.setItem(e),this.cell.removeItem())}dropItem(){this.item&&!this.cell.getItem()&&(this.cell.setItem(this.item),this.item=null)}getMoveCell(e,l=!1){const t=this.cell.level.getMoveCell(this.cell.x,this.cell.y,e);return t&&t.isEmpty&&(t.getType()===y.Empty||t.getType()===y.Hole)&&(l||!t.character)?t:void 0}say(e,l){const t=this.cell.level.getMoveCell(this.cell.x,this.cell.y,l);t&&t.character&&t.character.hear===e&&(t.character.hear=null,t.character.currentLine++)}terminate(){this.isTerminated=!0}die(){this.isDead=!0,this.terminate(),this.cell.character=null}}class J extends G{constructor(){super(...arguments);this.isEmpty=!0}getType(){return y.Empty}}class Z extends G{constructor(){super(...arguments);this.isEmpty=!0}getType(){return y.Hole}}class K extends G{constructor(){super(...arguments);this.isEmpty=!0}getType(){return y.Wall}}class O{constructor(e){this.cells={},this.game=e}serialize(e){const l={task:this.task,width:this.width,height:this.height,cells:[],winCallback:this.winCallback,object:e?this:void 0};return Object.values(this.cells).forEach(t=>{const s=t.getCharacter();l.cells.push({x:t.x,y:t.y,type:t.getType(),character:s?{name:s.name,color:s.color,coordinates:[t.x,t.y],object:e?s:void 0}:null,item:t.getItem()?{isRandom:t.getItem().isRandom,value:t.getItem().value,tag:t.getItem().tag}:void 0,object:e?t:void 0})}),l}deserialize(e){this.task=e.task,this.width=e.width,this.height=e.height,this.winCallback=e.winCallback,e.cells.forEach(l=>{let t;l.type===y.Empty&&(t=new J(this,l.x,l.y)),l.type===y.Hole&&(t=new Z(this,l.x,l.y)),l.type===y.Printer&&(t=new q(this,l.x,l.y)),l.type===y.Shredder&&(t=new B(this,l.x,l.y)),l.type===y.Wall&&(t=new K(this,l.x,l.y)),l.character&&t.setCharacter(new de(t,l.character.name)),l.item&&(t.setItem(new X(l.item.value,l.item.isRandom)),l.item.tag&&(t.getItem().tag=l.item.tag)),this.addCell(l.x,l.y,t)})}addCharacter(e,l,t){this.getCell(l,t).setCharacter(e)}moveCharacters(){const e=this.getCharacters().filter(t=>t.nextMove),l=[...e];for(;l.length;)l.forEach(t=>{const s=t.nextMove;if(s&&!s.character){console.log(t.name,"move to empty"),t.cell.character=null,t.cell=s,s.character=t,l.splice(l.indexOf(t),1),t.nextMove=null;return}if(s&&s.character&&s.character.nextMove&&s.character.nextMove===t.cell){const i=t.cell,a=s.character.cell,d=t,c=s.character;i.character=c,a.character=d,d.cell=a,c.cell=i,l.splice(l.indexOf(t),1),l.splice(l.indexOf(s.character),1),d.nextMove=null,c.nextMove=null;return}s&&s.character&&!s.character.nextMove&&(console.log(t.name,"move to character",s.character.name),l.splice(l.indexOf(t),1),t.nextMove=null)});e.forEach(t=>{t.cell.getType()===y.Hole&&t.die()}),console.log(this.getCharacters().filter(t=>t.nextMove))}addCell(e,l,t){this.cells[`${e}x${l}`]=t}getCell(e,l){return this.cells[`${e}x${l}`]}getMoveCell(e,l,t){if(t===v.Here)return this.getCell(e,l);if(t===v.Up)return this.getCell(e,l-1);if(t===v.Down)return this.getCell(e,l+1);if(t===v.Left)return this.getCell(e-1,l);if(t===v.Right)return this.getCell(e+1,l);if(t===v.UpLeft)return this.getCell(e-1,l-1);if(t===v.UpRight)return this.getCell(e+1,l-1);if(t===v.DownLeft)return this.getCell(e-1,l+1);if(t===v.DownRight)return this.getCell(e+1,l+1)}getCharacters(){return Object.values(this.cells).map(e=>e.getCharacter()).filter(e=>e!==null)}findNear(e,l){const t=[],s={[`${e[0]}x${e[1]}`]:0};if(this.markNearRecursive(e,l,1,s,t),t.length){t.sort((a,d)=>s[a]-s[d]);const i=this.getPathRecursive(this.cells[t[0]],s);return i.reverse(),i}return[]}getPathRecursive(e,l={},t=[]){if(t.push(e),l[`${e.x}x${e.y}`]===0)return t;for(const s in Object.values(m)){const i=Object.values(m)[s],a=this.getMoveCell(e.x,e.y,i);if(a&&l[`${a.x}x${a.y}`]===l[`${e.x}x${e.y}`]-1)return this.getPathRecursive(a,l,t)}return t}markNearRecursive(e,l,t,s={},i=[]){if(this.cells[`${e[0]}x${e[1]}`])for(const a in Object.values(m)){const d=Object.values(m)[a],c=this.getMoveCell(e[0],e[1],d);if(!!c&&!(c.getType()!==y.Empty&&!l(c))&&!(s[`${c.x}x${c.y}`]!==void 0&&s[`${c.x}x${c.y}`]<=t)){if(s[`${c.x}x${c.y}`]=t,c&&l(c)){i.push(`${c.x}x${c.y}`);return}this.markNearRecursive([c.x,c.y],l,t+1,s,i)}}}changeSize(e,l){for(let t=0;t<e;t++)for(let s=0;s<l;s++)this.cells[`${t}x${s}`]||(this.cells[`${t}x${s}`]=new J(this,t,s));this.width=e,this.height=l}crop(e,l){Object.keys(this.cells).forEach(t=>{const s=t.split("x");(parseInt(s[0])>=e||parseInt(s[1])>=l)&&delete this.cells[t]}),this.width=e,this.height=l}}O.parseCells=(r,e)=>{const l=[];return r.split(/[\r\n]+/).forEach((t,s)=>{t.split(/ +/).forEach((i,a)=>{const d=i.split("|"),c={type:y.Empty,x:a,y:s,character:void 0};d[0]==="box"&&(c.item={value:parseInt(d[1]),isRandom:d[1]==="random",tag:d[2]}),d[0]==="hole"&&(c.type=y.Hole),d[0]==="wall"&&(c.type=y.Wall),d[0]==="printer"&&(c.type=y.Printer),d[0]==="shredder"&&(c.type=y.Shredder);const D=e.find(h=>h.coordinates[0]===a&&h.coordinates[1]===s);D&&(c.character=D),l.push(c)})}),l};var M;(function(r){r.Add="+",r.Subtract="-",r.Multiply="*",r.Divide="/"})(M||(M={}));var f;(function(r){r.Number="number",r.Direction="direction",r.Slot="slot",r.MyItem="myItem"})(f||(f={}));class ue extends C{constructor(){super(...arguments);this.operand1type=f.Number,this.operand1NumberValue=0,this.operand1DirectionValue=v.Up,this.operand1SlotValue=0,this.operator=M.Add,this.operand2type=f.Number,this.operand2NumberValue=0,this.operand2DirectionValue=v.Up,this.operand2SlotValue=0,this.slotResult=0}execute(e){var a,d,c,D,h,p;let l=0,t=0,s=0;this.operand1type===f.Number&&(l=this.operand1NumberValue),this.operand1type===f.Direction&&(l=((d=(a=this.level.getMoveCell(e.cell.x,e.cell.y,this.operand1DirectionValue))==null?void 0:a.item)==null?void 0:d.value)||0),this.operand1type===f.Slot&&(l=e.slots[this.operand1SlotValue].getNumberValue()),this.operand1type===f.MyItem&&(l=((c=e.item)==null?void 0:c.value)||0),this.operand2type===f.Number&&(t=this.operand2NumberValue),this.operand2type===f.Direction&&(t=((h=(D=this.level.getMoveCell(e.cell.x,e.cell.y,this.operand2DirectionValue))==null?void 0:D.item)==null?void 0:h.value)||0),this.operand2type===f.Slot&&(t=e.slots[this.operand2SlotValue].getNumberValue()),this.operand2type===f.MyItem&&(t=((p=e.item)==null?void 0:p.value)||0),this.operator===M.Add?s=l+t:this.operator===M.Subtract?s=l-t:this.operator===M.Multiply?s=l*t:this.operator===M.Divide&&(s=l/t);const i=new Y(e);return i.setNumber(s),e.slots[this.slotResult]=i,e.currentLine+1}setOperand1MyItem(){this.operand1type=f.MyItem}setOperand1Number(e){this.operand1type=f.Number,this.operand1NumberValue=e}setOperand1Direction(e){this.operand1type=f.Direction,this.operand1DirectionValue=e}setOperand1Slot(e){this.operand1type=f.Slot,this.operand1SlotValue=e}setOperand2MyItem(){this.operand2type=f.MyItem}setOperand2Number(e){this.operand2type=f.Number,this.operand2NumberValue=e}setOperand2Direction(e){this.operand2type=f.Direction,this.operand2DirectionValue=e}setOperand2Slot(e){this.operand2type=f.Slot,this.operand2SlotValue=e}serialize(e=!1){return{type:o.Calc,operand1type:this.operand1type,operand1NumberValue:this.operand1NumberValue,operand1DirectionValue:this.operand1DirectionValue,operand1SlotValue:this.operand1SlotValue,operator:this.operator,operand2type:this.operand2type,operand2NumberValue:this.operand2NumberValue,operand2DirectionValue:this.operand2DirectionValue,operand2SlotValue:this.operand2SlotValue,slotResult:this.slotResult,object:e?this:void 0}}deserialize(e){this.operand1type=e.operand1type,this.operand1NumberValue=e.operand1NumberValue,this.operand1DirectionValue=e.operand1DirectionValue,this.operand1SlotValue=e.operand1SlotValue,this.operator=e.operator,this.operand2type=e.operand2type,this.operand2NumberValue=e.operand2NumberValue,this.operand2DirectionValue=e.operand2DirectionValue,this.operand2SlotValue=e.operand2SlotValue,this.slotResult=e.slotResult}}class pe extends C{execute(e){return e.dropItem(),e.currentLine+1}serialize(e){return{type:o.Drop,object:e?this:void 0}}deserialize(e){}}class me extends C{execute(e){return e.terminate(),e.currentLine}serialize(e){return{type:o.End,object:e?this:void 0}}deserialize(e){}}class ve extends C{execute(e){const l=this.level.game.code.find(a=>a.id===this.operatorForeach.id),t=l.directions,s=e.foreachLoops[this.operatorForeach.id];return t.indexOf(s)===t.length-1?(e.foreachLoops[this.operatorForeach.id]=void 0,e.currentLine+1):this.level.game.code.findIndex(a=>a===l)}serialize(e){return{type:o.EndForeach,id:this.id,operatorForeach:this.operatorForeach.id,object:e?this:void 0}}deserialize(e){this.id=e.id,this.operatorForeachId=e.operatorForeach}postDeserialize(){this.operatorForeach=this.level.game.code.find(e=>e.id===this.operatorForeachId)}}class fe extends C{remove(){const e=this.level.game.code.findIndex(l=>l===this.operatorIf);this.level.game.code.splice(e,1)}execute(e){return e.currentLine+1}serialize(e){return{type:o.EndIf,id:this.id,operatorIf:this.operatorIf.id,object:e?this:void 0}}deserialize(e){this.id=e.id,this.operatorIfId=e.operatorIf}postDeserialize(){this.operatorIf=this.level.game.code.find(e=>e.id===this.operatorIfId)}}class H extends he{setCell(e){this.cellValue=e}getCellValue(){return this.cellValue}getNumberValue(){var e,l;return((l=(e=this.cellValue)==null?void 0:e.item)==null?void 0:l.value)||0}}class ye extends C{constructor(){super(...arguments);this.directions=[],this.slotNumber=0}execute(e){if(e.foreachLoops[this.id]){const l=this.directions,t=e.foreachLoops[this.id],s=l.indexOf(t);e.foreachLoops[this.id]=l[s+1];const i=new H(e);i.setCell(this.level.getMoveCell(e.cell.x,e.cell.y,l[s+1])),e.slots[this.slotNumber]=i}else{e.foreachLoops[this.id]=this.directions[0];const l=new H(e);l.setCell(this.level.getMoveCell(e.cell.x,e.cell.y,this.directions[0])),e.slots[this.slotNumber]=l}return e.currentLine+1}createEndForeach(){const e=new ve(this.level);return e.operatorForeach=this,this.operatorEndForeach=e,e}setDirections(e){this.directions=e}serialize(e){return{type:o.Foreach,id:this.id,operatorEndForeach:this.operatorEndForeach.id,directions:this.directions,slotNumber:this.slotNumber,object:e?this:void 0}}deserialize(e){this.id=e.id,this.operatorEndForeachId=e.operatorEndForeach,this.directions=e.directions,this.slotNumber=e.slotNumber}postDeserialize(){this.operatorEndForeach=this.level.game.code.find(e=>e.id===this.operatorEndForeachId)}}class be extends C{constructor(e){super(e);this.direction=m.Down}setDirection(e){this.direction=e}execute(e){return e.giveItem(this.direction),e.currentLine+1}serialize(e){return{type:o.Give,direction:this.direction,slot:this.slot,object:e?this:void 0}}deserialize(e){this.direction=e.direction,this.slot=e.slot}}class ge extends C{constructor(){super(...arguments);this.line=0}execute(e){return this.line}setLine(e){this.line=e}serialize(e){return{type:o.Goto,line:this.line,object:e?this:void 0}}deserialize(e){this.line=e.line}}class je extends C{execute(e){return e.hear=this.hear,e.currentLine+1}setHear(e){this.hear=e}serialize(e){return{type:o.Hear,hear:this.hear,object:e?this:void 0}}deserialize(e){this.hear=e.hear}}var L;(function(r){r.Eq="eq",r.Ne="ne",r.Gt="gt",r.Ge="ge",r.Lt="lt",r.Le="le"})(L||(L={}));var F;(function(r){r.And="and",r.Or="or"})(F||(F={}));var w;(function(r){r.Direction="direction",r.Number="number",r.Slot="slot",r.MyItem="myItem"})(w||(w={}));var S;(function(r){r.Direction="direction",r.Number="number",r.Slot="slot",r.MyItem="myItem",r.Box="box",r.Printer="printer",r.Shredder="shredder",r.Character="character",r.Hole="hole"})(S||(S={}));class Ce extends C{constructor(e){super(e);this.conditions=[],this.addCondition()}addCondition(){this.conditions.push({type:L.Eq,leftType:w.Number,leftDirection:v.Down,leftNumber:0,leftSlot:0,rightType:S.Number,rightDirection:v.Down,rightNumber:0,rightSlot:0,logic:F.Or})}removeCondition(e){this.conditions.splice(e,1)}checkCondition(e){let l=!1;return this.conditions.forEach(t=>{var a,d,c,D;let s=!1;const i=t.type===L.Eq;if(t.rightType===S.Box)t.leftType===w.MyItem&&(s=!!e.item,i||(s=!s)),t.leftType===w.Slot&&e.slots[t.leftSlot]instanceof H&&(s=!!e.slots[t.leftSlot].cellValue.item,i||(s=!s)),t.leftType===w.Direction&&(s=!!this.level.getMoveCell(e.cell.x,e.cell.y,t.leftDirection).item,i||(s=!s));else if(t.rightType===S.Printer||t.rightType===S.Shredder||t.rightType===S.Hole)t.leftType===w.Slot&&e.slots[t.leftSlot]instanceof H&&(s=e.slots[t.leftSlot].cellValue.getType()===t.rightType,i||(s=!s)),t.leftType===w.Direction&&(s=this.level.getMoveCell(e.cell.x,e.cell.y,t.leftDirection).getType()===t.rightType,i||(s=!s));else{let h=0,p=0;switch(t.leftType===w.Number?h=t.leftNumber:t.leftType===w.Slot?h=e.slots[t.leftSlot].getNumberValue():t.leftType===w.MyItem?h=((a=e.item)==null?void 0:a.value)||0:t.leftType===w.Direction&&(h=((d=this.level.getMoveCell(e.cell.x,e.cell.y,t.leftDirection).item)==null?void 0:d.value)||0),t.rightType===S.Number?p=t.rightNumber:t.rightType===S.Slot?p=e.slots[t.rightSlot].getNumberValue():t.rightType===S.MyItem?p=((c=e.item)==null?void 0:c.value)||0:t.rightType===S.Direction&&(p=((D=this.level.getMoveCell(e.cell.x,e.cell.y,t.rightDirection).item)==null?void 0:D.value)||0),t.type){case L.Eq:s=h===p;break;case L.Ne:s=h!==p;break;case L.Gt:s=h>p;break;case L.Ge:s=h>=p;break;case L.Lt:s=h<p;break;case L.Le:s=h<=p;break}}t.logic===F.And?l=l&&s:t.logic===F.Or&&(l=l||s)}),l}remove(){const e=this.level.game.code.findIndex(l=>l===this.operatorEndIf);this.level.game.code.splice(e,1)}execute(e){return this.checkCondition(e)?e.currentLine+1:this.level.game.code.findIndex(l=>l===this.operatorEndIf)+1}createEndIf(){const e=new fe(this.level);return e.operatorIf=this,this.operatorEndIf=e,e}serialize(e){return{type:o.If,id:this.id,conditions:this.conditions,operatorEndIf:this.operatorEndIf.id,object:e?this:void 0}}deserialize(e){this.id=e.id,this.operatorEndIfId=e.operatorEndIf,this.conditions=e.conditions}postDeserialize(){this.operatorEndIf=this.level.game.code.find(e=>e.id===this.operatorEndIfId)}}var P;(function(r){r.Printer="printer",r.Shredder="shredder",r.Hole="hole",r.Empty="empty"})(P||(P={}));class xe extends C{constructor(){super(...arguments);this.slot=0,this.nearType=P.Printer,this.numberValue=0,this.slotValue=0}execute(e){const l=this.level.findNear([e.cell.x,e.cell.y],s=>s.getType()===this.nearType);let t=l[l.length-1];return(this.nearType===P.Printer||this.nearType===P.Shredder)&&(t=this.level.getMoveCell(t.x,t.y,m.Up)),e.slots[this.slot]=new H(e),e.slots[this.slot].setCell(t),e.currentLine+1}setSlot(e){this.slot=e}setNearType(e){this.nearType=e}serialize(e){return{type:o.Near,slot:this.slot,nearType:this.nearType,object:e?this:void 0}}deserialize(e){this.slot=e.slot,this.nearType=e.nearType}}class we extends C{execute(e){return e.pickupItem(),e.currentLine+1}serialize(e){return{type:o.Pickup,object:e?this:void 0}}deserialize(e){}}class Se extends C{execute(e){return e.say(this.hear,this.direction),e.currentLine+1}setSay(e){this.hear=e}setDirection(e){this.direction=e}serialize(e){return{type:o.Say,hear:this.hear,direction:this.direction,object:e?this:void 0}}deserialize(e){this.hear=e.hear,this.direction=e.direction}}class Ie extends C{constructor(e){super(e);this.direction=m.Down}setDirection(e){this.direction=e}execute(e){return e.take(this.direction),e.currentLine+1}serialize(e){return{type:o.Take,direction:this.direction,object:e?this:void 0}}deserialize(e){this.direction=e.direction}}var R;(function(r){r.Number="number",r.Slot="slot",r.MyItem="myItem"})(R||(R={}));class De extends C{constructor(){super(...arguments);this.slot=0,this.variableType=R.Number,this.numberValue=0,this.slotValue=0}execute(e){return this.variableType===R.Number&&(e.slots[this.slotValue]=new Y(e),e.slots[this.slotValue].setNumber(this.numberValue)),e.currentLine+1}setSlot(e){this.slot=e}setNumberValue(e){this.variableType=R.Number,this.numberValue=e}setSlotValue(e){this.variableType=R.Slot,this.slotValue=e}setMyItemValue(){this.variableType=R.MyItem}serialize(e){return{type:o.Variable,slot:this.slot,variableType:this.variableType,numberValue:this.numberValue,slotValue:this.slotValue,object:e?this:void 0}}deserialize(e){this.slot=e.slot,this.variableType=e.variableType,this.numberValue=e.numberValue,this.slotValue=e.slotValue}}var $;(function(r){r.Number="number",r.Slot="slot"})($||($={}));class Le extends C{constructor(){super(...arguments);this.value=0,this.slot=0,this.writeType=$.Number}execute(e){return this.writeType===$.Number&&e.write(this.value),this.writeType===$.Slot&&e.write(e.slots[this.slot].getNumberValue()),e.currentLine+1}setLine(e){this.value=e}serialize(e){return{type:o.Write,writeType:this.writeType,value:this.value,object:e?this:void 0}}deserialize(e){this.value=e.value,this.writeType=e.writeType}}var z;(function(r){r.Run="Run",r.Stop="Stop"})(z||(z={}));class ee{constructor(){this.name="",this.code=[],this.state=z.Stop,this.speed=1e3}getLevel(){return this.level}setLevel(e){this.level=e}addOperator(e,l){let t;e===o.Pickup&&(t=new we(this.level)),e===o.Drop&&(t=new pe(this.level)),e===o.End&&(t=new me(this.level)),e===o.Goto&&(t=new ge(this.level)),e===o.Hear&&(t=new je(this.level)),e===o.If&&(t=new Ce(this.level),this.code.splice(l,0,t.createEndIf())),e===o.Say&&(t=new Se(this.level)),e===o.Step&&(t=new oe(this.level)),e===o.Take&&(t=new Ie(this.level)),e===o.Variable&&(t=new De(this.level)),e===o.Write&&(t=new Le(this.level)),e===o.Foreach&&(t=new ye(this.level),this.code.splice(l,0,t.createEndForeach())),e===o.Give&&(t=new be(this.level)),e===o.Near&&(t=new xe(this.level)),e===o.Calc&&(t=new ue(this.level)),t&&this.code.splice(l,0,t)}removeOperator(e){const l=this.code[e];this.code.splice(e,1),l.remove()}start(){this.state=z.Run,this.interval=window.setInterval(()=>{this.state===z.Run&&this.update()},this.speed)}stop(){clearInterval(this.interval),this.state=z.Stop}update(){!this.level.getCharacters().filter(e=>!e.isTerminated).length||(this.level.getCharacters().forEach(e=>{e.prepare()}),this.level.getCharacters().forEach(e=>{e.update()}),this.level.moveCharacters(),this.level.winCallback(this.level),this.level.getCharacters().length<2&&console.log("Wrong character"),console.log(this.level.cells),this.render())}deserializeCode(e){this.code=e.map(l=>{if(l.type===o.Drop){const t=new pe(this.level);return t.deserialize(l),t}if(l.type===o.End){const t=new me(this.level);return t.deserialize(l),t}if(l.type===o.Foreach){const t=new ye(this.level);return t.deserialize(l),t}if(l.type===o.EndForeach){const t=new ve(this.level);return t.deserialize(l),t}if(l.type===o.Give){const t=new be(this.level);return t.deserialize(l),t}if(l.type===o.Goto){const t=new ge(this.level);return t.deserialize(l),t}if(l.type===o.Hear){const t=new je(this.level);return t.deserialize(l),t}if(l.type===o.If){const t=new Ce(this.level);return t.deserialize(l),t}if(l.type===o.EndIf){const t=new fe(this.level);return t.deserialize(l),t}if(l.type===o.Calc){const t=new ue(this.level);return t.deserialize(l),t}if(l.type===o.Near){const t=new xe(this.level);return t.deserialize(l),t}if(l.type===o.Pickup){const t=new we(this.level);return t.deserialize(l),t}if(l.type===o.Say){const t=new Se(this.level);return t.deserialize(l),t}if(l.type===o.Step){const t=new oe(this.level);return t.deserialize(l),t}if(l.type===o.Take){const t=new Ie(this.level);return t.deserialize(l),t}if(l.type===o.Variable){const t=new De(this.level);return t.deserialize(l),t}if(l.type===o.Write){const t=new Le(this.level);return t.deserialize(l),t}return console.error("Unknown operator type",l.type),null}),this.code.forEach(l=>l.postDeserialize())}deserialize(e){this.level||(this.level=new O(this)),this.name=e.name,this.level.deserialize(e.level),this.deserializeCode(e.code)}serialize(e=!1){return{level:this.level.serialize(e),name:this.name,code:this.code.map(l=>l.serialize(e)),state:this.state,speed:this.speed,object:e?this:void 0}}moveOperator(e,l){if(!this.code[e]||!this.code[l])return;const t=this.code[e];this.code.splice(e,1),this.code.splice(l,0,t)}render(){console.log("render"),this.renderCallback(this.serialize(!0))}}const k=80;function Ne(r){const e=r.game.object.level.cells,l=Object.keys(e).map(s=>{const i=ce(s),a=e[s];let d;return a instanceof J&&(d=null,a.getItem()&&(d=u(_,{children:[n(le,{fontSize:"small"})," ",a.item.isRandom&&r.game.state!==z.Run?"?":a.item.value]}))),a instanceof Z&&(d=n("div",{style:{width:"100%",height:"100%",backgroundColor:"black"}})),a instanceof K&&(d="wall"),a instanceof q&&(d="printer"),a instanceof B&&(d="shredder"),n("div",{onClick:()=>r.onClick(s),style:{position:"absolute",left:i[0]*k,top:i[1]*k,width:k,height:k,borderStyle:"solid",borderColor:"black",borderWidth:1,display:"flex",alignItems:"center",justifyContent:"center"},children:d},s)}),t=r.game.object.level.getCharacters().sort((s,i)=>s.name>i.name?1:-1).map(s=>{const i=[s.cell.x,s.cell.y];return u("div",{style:{position:"absolute",opacity:s.isDead?0:1,transform:`translate(${i[0]*k}px, ${i[1]*k+10}px)`,transition:`all ${r.game.speed}ms ease-in`},children:[n(U,{fontSize:"small",style:{color:s.color}}),s.item?u(_,{children:["(",n(le,{fontSize:"small"})," ",s.item.value,")"]}):null]},s.name)});return u("div",{style:{position:"relative",width:r.game.level.width*k+k/2,height:r.game.level.height*k+k/2},children:[l,t]})}function Ze(r){return n(_,{children:Object.values(o).map(e=>n("div",{children:n(V,{onClick:()=>{r.game.object.addOperator(e,0),r.game.object.render()},children:`Add ${e}`})},e))})}const Ke=(r,e,l)=>u("span",{children:["Step:"," ",n(b,{IconComponent:null,value:r.object.type,onChange:t=>{t.target.value===x.Direction&&(r.object.setDirection([m.Down]),l.object.render()),t.target.value===x.Slot&&(r.object.setSlot(0),l.object.render())},variant:"standard",children:Object.values(x).map(t=>n(g,{value:t,children:t},t))}),r.object.type===x.Direction&&n(b,{IconComponent:null,value:r.object.directions,variant:"standard",multiple:!0,onChange:t=>{r.object.setDirection(t.target.value),l.object.render()},children:Object.values(m).map(t=>u(g,{value:t,children:[T(t),t]},t))}),r.object.type===x.Slot&&n(j,{type:"number",value:r.slot,variant:"standard",onChange:t=>{r.object.setSlot(parseInt(t.target.value)||0),l.object.render()}})]}),et=(r,e,l)=>u("span",{children:["Give:"," ",n(U,{fontSize:"small"}),n(re,{fontSize:"small"}),n(se,{fontSize:"small"})," ",n(b,{IconComponent:null,value:r.direction,variant:"standard",onChange:t=>{r.object.setDirection(t.target.value),l.object.render()},children:Object.values(m).map(t=>u(g,{value:t,children:[T(t),t]},t))})]}),tt=(r,e,l)=>u("span",{children:["Take"," ",n(U,{fontSize:"small"}),n(te,{fontSize:"small"}),n(se,{fontSize:"small"})," ",n(b,{IconComponent:null,value:r.direction,variant:"standard",onChange:t=>{r.object.setDirection(t.target.value),l.object.render()},children:Object.values(m).map(t=>u(g,{value:t,children:[T(t),t]},t))})]}),rt=(r,e,l)=>u("span",{children:["Goto:"," ",n(b,{IconComponent:null,value:r.line,variant:"standard",onChange:t=>{r.object.setLine(parseInt(t.target.value.toString())),l.object.render()},children:Object.keys(l.code).map(t=>n(g,{value:t,children:t},t))})]}),lt=(r,e,l)=>u("span",{children:["If:"," ",r.conditions.map((t,s)=>u("span",{children:[!!s&&n(b,{IconComponent:null,value:t.logic,variant:"standard",onChange:i=>{r.object.conditions[s].logic=i.target.value,l.object.render()},children:Object.values(F).map(i=>n(g,{value:i,children:i},i))}),n(b,{IconComponent:null,value:t.leftType,onChange:i=>{r.object.conditions[s].leftType=i.target.value,l.object.render()},variant:"standard",children:Object.values(w).map(i=>n(g,{value:i,children:i},i))}),t.leftType==="number"&&n(j,{type:"number",value:t.leftNumber,variant:"standard",onChange:i=>{r.object.conditions[s].leftNumber=parseInt(i.target.value)||0,l.object.render()}}),t.leftType==="direction"&&n(b,{IconComponent:null,value:t.leftDirection,variant:"standard",onChange:i=>{r.object.conditions[s].leftDirection=i.target.value,l.object.render()},children:Object.values(v).map(i=>u(g,{value:i,children:[T(i),i]},i))}),t.leftType==="slot"&&n(j,{type:"number",value:t.leftSlot,variant:"standard",onChange:i=>{r.object.conditions[s].leftSlot=parseInt(i.target.value)||0,l.object.render()}}),n(b,{IconComponent:null,value:t.type,variant:"standard",onChange:i=>{r.object.conditions[s].type=i.target.value,l.object.render()},children:Object.values(L).map(i=>n(g,{value:i,children:i},i))}),n(b,{IconComponent:null,value:t.rightType,onChange:i=>{r.object.conditions[s].rightType=i.target.value,l.object.render()},variant:"standard",children:Object.values(S).map(i=>n(g,{value:i,children:i},i))}),t.rightType==="number"&&n(j,{type:"number",value:t.rightNumber,variant:"standard",onChange:i=>{r.object.conditions[s].rightNumber=parseInt(i.target.value)||0,l.object.render()}}),t.rightType==="direction"&&n(b,{IconComponent:null,value:t.rightDirection,variant:"standard",onChange:i=>{r.object.conditions[s].rightDirection=i.target.value,l.object.render()},children:Object.values(v).map(i=>u(g,{value:i,children:[T(i),i]},i))}),t.rightType==="slot"&&n(j,{type:"number",value:t.rightSlot,variant:"standard",onChange:i=>{r.object.conditions[s].rightSlot=parseInt(i.target.value)||0}}),r.conditions.length>1&&n(Q,{size:"small",onMouseDown:()=>{r.object.removeCondition(s),l.object.render()},children:n($e,{})}),s===r.conditions.length-1&&n(Q,{size:"small",onMouseDown:()=>{r.object.addCondition(),l.object.render()},children:n(Fe,{})})]},s))]}),st=()=>"Pickup",it=()=>"Drop",nt=(r,e,l)=>u("span",{children:["Near:"," ","slot",n(j,{type:"number",value:r.slot,variant:"standard",onChange:t=>{r.object.setSlot(parseInt(t.target.value)||0),l.object.render()}}),"=",n(b,{IconComponent:null,value:r.nearType,onChange:t=>{r.object.setNearType(t.target.value),l.object.render()},variant:"standard",children:Object.values(P).map(t=>n(g,{value:t,children:t},t))})]}),at=(r,e,l)=>u("span",{children:["Variable"," ","slot",n(j,{type:"number",value:r.slot,variant:"standard",onChange:t=>{r.object.setSlot(parseInt(t.target.value)||0),l.object.render()}}),"=",n(b,{IconComponent:null,value:r.variableType,onChange:t=>{t.target.value==="number"&&r.object.setNumberValue(0),t.target.value==="myitem"&&r.object.setMyItemValue(),t.target.value==="slot"&&r.object.setSlotValue(0)},variant:"standard",children:Object.values(R).map(t=>n(g,{value:t,children:t},t))}),r.variableType==="number"&&n(j,{type:"number",value:r.numberValue,variant:"standard",onChange:t=>{r.object.setNumberValue(parseInt(t.target.value)||0),l.object.render()}}),r.variableType==="slot"&&n(j,{type:"number",value:r.slotValue,variant:"standard",onChange:t=>{r.object.setSlotValue(parseInt(t.target.value)||0),l.object.render()}})]}),ot=(r,e,l)=>u("span",{children:["Calc"," ","slot",n(j,{type:"number",value:r.slotResult,variant:"standard",onChange:t=>{r.object.slotResult=parseInt(t.target.value)||0,l.object.render()}}),"=",n(b,{IconComponent:null,value:r.operand1type,onChange:t=>{t.target.value==="number"&&r.object.setOperand1Number(0),t.target.value==="direction"&&r.object.setOperand1Direction(v.Up),t.target.value==="slot"&&r.object.setOperand1Slot(0),t.target.value==="myItem"&&r.object.setOperand1MyItem(),l.object.render()},variant:"standard",children:Object.values(f).map(t=>n(g,{value:t,children:t},t))}),r.operand1type===f.Number&&n(j,{type:"number",value:r.operand1NumberValue,variant:"standard",onChange:t=>{r.object.setOperand1Number(parseInt(t.target.value)||0),l.object.render()}}),r.operand1type===f.Direction&&n(b,{IconComponent:null,value:r.operand1DirectionValue,variant:"standard",onChange:t=>{r.object.setOperand1Direction(t.target.value),l.object.render()},children:Object.values(v).map(t=>u(g,{value:t,children:[T(t),t]},t))}),r.operand1type===f.Slot&&n(j,{type:"number",value:r.operand1SlotValue,variant:"standard",onChange:t=>{r.object.setOperand1Slot(parseInt(t.target.value)||0),l.object.render()}}),n(b,{IconComponent:null,value:r.operator,variant:"standard",onChange:t=>{r.operator=t.target.value},children:Object.values(M).map(t=>n(g,{value:t,children:t},t))}),n(b,{IconComponent:null,value:r.operand2type,onChange:t=>{t.target.value==="number"&&r.object.setOperand2Number(0),t.target.value==="direction"&&r.object.setOperand2Direction(v.Up),t.target.value==="slot"&&r.object.setOperand2Slot(0),t.target.value==="myItem"&&r.object.setOperand2MyItem(),l.object.render()},variant:"standard",children:Object.values(f).map(t=>n(g,{value:t,children:t},t))}),r.operand2type===f.Number&&n(j,{type:"number",value:r.operand2NumberValue,variant:"standard",onChange:t=>{r.object.setOperand2Number(parseInt(t.target.value)||0),l.object.render()}}),r.operand2type===f.Direction&&n(b,{IconComponent:null,value:r.operand2DirectionValue,variant:"standard",onChange:t=>{r.object.setOperand2Direction(t.target.value),l.object.render()},children:Object.values(v).map(t=>u(g,{value:t,children:[T(t),t]},t))}),r.operand2type===f.Slot&&n(j,{type:"number",value:r.operand2SlotValue,variant:"standard",onChange:t=>{r.object.setOperand2Slot(parseInt(t.target.value)||0),l.object.render()}})]}),ct=(r,e,l)=>u("span",{children:["Say:"," ",n(j,{value:r.hear,variant:"standard",onChange:t=>{r.object.setSay(t.target.value),l.object.render()}}),n(b,{IconComponent:null,value:r.direction,variant:"standard",onChange:t=>{r.object.setDirection(t.target.value),l.object.render()},children:Object.values(m).map(t=>u(g,{value:t,children:[T(t),t]},t))})]}),ht=(r,e,l)=>u("span",{children:["Hear:"," ",n(j,{value:r.hear,variant:"standard",onChange:t=>{r.object.hear=t.target.value,l.object.render()}})]}),dt=(r,e,l)=>u("span",{children:["Foreach:"," ",n(b,{IconComponent:null,value:r.directions,variant:"standard",multiple:!0,onChange:t=>{r.object.setDirections(t.target.value),l.object.render()},children:Object.values(m).map(t=>u(g,{value:t,children:[T(t),t]},t))}),n(j,{type:"number",value:r.slotNumber,variant:"standard",onChange:t=>{r.object.slotNumber=parseInt(t.target.value)||0,l.object.render()}})]}),ut=()=>"End",pt=(r,e,l)=>u("span",{children:["Write"," ",n(b,{IconComponent:null,value:r.writeType,onChange:t=>{t.target.value==="number",t.target.value==="myItem",l.object.render()},variant:"standard",children:Object.values($).map(t=>n(g,{value:t,children:t},t))}),r.writeType===$.Number&&n(j,{type:"number",value:r.value,variant:"standard",onChange:t=>{r.object.value=parseInt(t.target.value)||0,l.object.render()}})]});function mt(r,e,l,t){let s=null;return r.type==="step"&&(s=Ke(r,e,l)),r.type==="give"&&(s=et(r,e,l)),r.type==="take"&&(s=tt(r,e,l)),r.type==="goto"&&(s=rt(r,e,l)),r.type==="if"&&(s=lt(r,e,l)),r.type==="endif"&&(s="Endif"),r.type==="pickup"&&(s=st()),r.type==="drop"&&(s=it()),r.type==="near"&&(s=nt(r,e,l)),r.type==="variable"&&(s=at(r,e,l)),r.type==="calc"&&(s=ot(r,e,l)),r.type==="say"&&(s=ct(r,e,l)),r.type==="hear"&&(s=ht(r,e,l)),r.type==="foreach"&&(s=dt(r,e,l)),r.type==="endforeach"&&(s="Endforeach"),r.type==="end"&&(s=ut()),r.type==="write"&&(s=pt(r,e,l)),r.type==="endif"&&(t-=20),r.type==="endforeach"&&(t-=20),s=u("span",{children:[e,": ",n("span",{style:{paddingLeft:t},children:s}),n(Q,{size:"small",onMouseDown:()=>{l.object.removeOperator(e),l.object.render()},children:n(Pe,{fontSize:"small"})})]},e),r.type==="if"&&(t+=20),r.type==="foreach"&&(t+=20),{result:s,intend:t}}const vt=Ue(({children:r})=>n("div",{children:r})),ft=Ge(({children:r})=>n("div",{children:r}));function yt(r){const[e,l]=E.exports.useState();E.exports.useEffect(()=>{const i=new ee;i.deserialize(r.level),i.renderCallback=l,i.deserializeCode(JSON.parse(window.localStorage.getItem(`level${r.levelNumber}`))||[]),i.render()},[r.level]),e&&window.localStorage.setItem(`level${r.levelNumber}`,JSON.stringify(e.object.serialize().code));let t=0;const s=E.exports.useMemo(()=>e?e.code.map((i,a)=>{const d=mt(i,a,e,t);return t=d.intend,d.result}):[],[e==null?void 0:e.code]);return e?u(A,{container:!0,children:[u(A,{item:!0,md:6,children:[n("h2",{children:e.level.task}),n("h4",{children:e.state===z.Run&&e.level.winCallback(e.level.object)?"Win":null}),n(Ne,{game:e})]}),n(A,{item:!0,md:1,children:n(Ze,{game:e})}),n(A,{item:!0,md:5,children:u("div",{style:{paddingLeft:20},children:[n(ft,{onSortEnd:({oldIndex:i,newIndex:a},d)=>{d.ctrlKey||(e.object.moveOperator(i,a),e.object.render())},children:e.code.map((i,a)=>u(vt,{index:a,children:[e.object.level.getCharacters().filter(c=>c.currentLine===a).map(c=>n("span",{children:n(U,{fontSize:"small",style:{color:c.color}})},c.name)),s[a]]},i.object.id))}),u("div",{style:{paddingTop:20},children:["Speed:"," ",n(j,{variant:"standard",type:"number",value:1e3/e.speed,onChange:i=>{e.object.speed=1e3/(parseInt(i.target.value)||1),e.object.render()}})]}),u("div",{style:{display:"flex",gap:4},children:[n("div",{children:n(V,{variant:"contained",onClick:()=>{e.object.level.deserialize(r.level.level),e.object.render(),e.object.state===z.Run?e.object.stop():e.object.start()},disabled:t!==0,children:e.object.state===z.Run?"Stop":"Run"})}),n("div",{children:n(V,{variant:"contained",onClick:()=>W(JSON.stringify(e.object.serialize(),null,2)),children:"Copy"})}),n("div",{children:n(V,{variant:"contained",onClick:()=>{e.object.deserializeCode(r.level.code),e.object.render()},children:"Clear"})})]}),e.object.level.getCharacters().map(i=>{var a;return u("div",{children:[i.name," ",n("span",{style:{color:i.color},children:n(U,{fontSize:"small"})})," ",(a=i.slots)==null?void 0:a.map((d,c)=>u("span",{children:[d.getNumberValue()," "]},c))]},i.name)}),n("pre",{children:JSON.stringify(Object.values(e.object.level.cells).filter(i=>i.character).map(i=>{var a;return{name:(a=i.character)==null?void 0:a.name,line:i.character.currentLine,x:i.x,y:i.y}}),null,2)})]})})]}):null}const bt={name:"Remove two boxes",level:{task:"Remove two boxes",width:5,height:7,cells:O.parseCells(`box|1 box|1 wall box|1 hole
empty empty wall box|2 empty
empty empty wall box|3 empty
empty empty wall box|4 printer
empty empty empty box|5 empty
hole hole
hole hole`,[{coordinates:[0,0],name:"first",color:"red"},{coordinates:[1,0],name:"second",color:"green"}]),winCallback:r=>Object.values(r.cells).filter(e=>e.item).length+r.getCharacters().filter(e=>!e.isDead&&e.item).length===5},code:[]},gt={name:"Move boxes",level:{task:"Move boxes",width:5,height:5,cells:O.parseCells(`box|1 box|1 empty box|1 empty
        empty empty wall box|2 empty
        empty empty wall box|3 empty
        empty empty empty box|4 empty
        empty empty empty box|5 empty`,[{coordinates:[0,0],name:"first",color:"red"},{coordinates:[1,0],name:"second",color:"green"}]),winCallback:r=>Object.values(r.cells).filter(e=>e.item).length+r.getCharacters().filter(e=>!e.isDead&&e.item).length===5},code:[{type:o.Step,stepType:x.Direction,directions:[m.Left,m.Right,m.Up,m.Down]},{type:o.Step,stepType:x.Direction,directions:[m.Left,m.Right,m.Up,m.Down]},{type:o.Pickup},{type:o.Step,stepType:x.Direction,directions:[m.Left,m.Right,m.Up,m.Down]},{type:o.Step,stepType:x.Direction,directions:[m.Left,m.Right,m.Up,m.Down]},{type:o.Drop},{type:o.Goto,line:0}]},jt={name:"Remove only box with 2",level:{task:"Remove only box with 2",width:5,height:7,cells:O.parseCells(`empty empty empty empty empty
box|2|tag2 box|1|tag1 wall empty empty
empty empty wall empty empty
empty empty empty empty empty
empty empty empty empty empty
hole hole
hole hole`,[{coordinates:[0,0],name:"first",color:"red"},{coordinates:[1,0],name:"second",color:"green"}]),winCallback:r=>(Object.values(r.cells).find(e=>{var l;return((l=e.item)==null?void 0:l.tag)==="tag1"})||r.getCharacters().find(e=>{var l;return((l=e.item)==null?void 0:l.tag)==="tag1"}))&&!(Object.values(r.cells).find(e=>{var l;return((l=e.item)==null?void 0:l.tag)==="tag2"})||r.getCharacters().find(e=>{var l;return!e.isTerminated&&((l=e.item)==null?void 0:l.tag)==="tag2"}))},code:[]},Ct={name:"Diagonal boxes",level:{task:"Diagonal boxes",width:5,height:7,cells:O.parseCells(`empty empty empty empty empty
box|1 box|1 box|1 box|1 box|1
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty`,[{coordinates:[1,1],name:"first",color:"red"},{coordinates:[2,1],name:"second",color:"green"},{coordinates:[3,1],name:"3",color:"yellow"},{coordinates:[4,1],name:"4",color:"blue"}]),winCallback:r=>[0,1,2,3,4].every(e=>r.cells[`${e}x${e+1}`].item)},code:[]},xt={name:"Sort numbers",level:{task:"Sort numbers",width:5,height:5,cells:O.parseCells(`empty empty empty empty empty
box|random box|0 box|random box|random box|random
empty empty empty empty empty
empty empty empty empty empty
empty empty empty empty empty`,[{coordinates:[0,1],name:"1",color:"purple"},{coordinates:[1,1],name:"2",color:"red"},{coordinates:[2,1],name:"3",color:"green"},{coordinates:[3,1],name:"4",color:"yellow"},{coordinates:[4,1],name:"5",color:"blue"}]),winCallback:r=>[0,1,2,3,4].every(e=>{var l,t,s,i;return e===0||((t=(l=r.cells[`${e}x1`].character)==null?void 0:l.item)==null?void 0:t.value)>=((i=(s=r.cells[`${e-1}x1`].character)==null?void 0:s.item)==null?void 0:i.value)})},code:[]},wt={name:"Print and shred",level:{task:"Print and shred 10 boxes",width:5,height:5,cells:O.parseCells(`empty empty empty empty empty
empty empty empty empty empty
empty printer shredder empty empty
empty empty empty empty empty
empty empty empty empty empty`,[{coordinates:[1,1],name:"first",color:"red"},{coordinates:[2,1],name:"second",color:"green"}]),winCallback:r=>r.cells["2x2"].shredded>=10},code:[]},St={name:"Print and shred",level:{task:"Print and shred 10 boxes (no move)",width:7,height:5,cells:O.parseCells(`hole hole hole hole hole hole hole
hole empty empty empty empty empty hole
hole printer hole hole hole shredder hole
hole hole hole hole hole hole hole
hole hole hole hole hole hole hole`,[{coordinates:[1,1],name:"1",color:"purple"},{coordinates:[2,1],name:"2",color:"red"},{coordinates:[3,1],name:"3",color:"green"},{coordinates:[4,1],name:"4",color:"yellow"},{coordinates:[5,1],name:"5",color:"blue"}]),winCallback:r=>r.cells["5x2"].shredded>=10},code:[]},It=[bt,gt,jt,Ct,xt,wt,St];class I{static preloadLevels(){It.forEach(e=>{I.load(e.name)||I.save(e.name,e)})}static getLevels(){const e=localStorage.getItem("levels");if(e)try{return ie.deserialize(e)}catch{return[]}return[]}static setLevels(e){localStorage.setItem("levels",ie.serialize(e))}static save(e,l){const t=this.getLevels();let s;typeof e=="string"?s=t.findIndex(i=>i.name===e):s=e,s===-1?t.push(l):t[s]=l,this.setLevels(t)}static load(e){const l=I.getLevels();return typeof e=="string"?l.find(t=>t.name===e):l[e]}static remove(e){const l=I.getLevels(),t=l.findIndex(s=>s.name===e);t!==-1&&(l.splice(t,1),I.setLevels(l))}}function Dt(r){var D;const[e,l]=E.exports.useState(()=>{const h=new ee;return h.deserialize(I.load(0)),h.renderCallback=p=>l(p),h.serialize(!0)}),[t,s]=E.exports.useState(!1),i=e.object.level.cells[t],[a,d]=E.exports.useState(0),c=JSON.stringify(e.object.serialize(),null,2);return u("div",{children:[u("div",{children:[n(b,{variant:"standard",value:a,onChange:h=>d(parseInt(h.target.value)),children:r.levels.map((h,p)=>n(g,{value:p,children:h.level.task},p))}),n(V,{onClick:()=>{const h=new ee;h.deserialize(I.load(a)),h.renderCallback=p=>l(p),h.render()},children:"Import"}),n(V,{onClick:()=>W(JSON.stringify(e.object.level.serialize(!1),null,2)),children:"Copy cells"}),n(V,{onClick:()=>W(JSON.stringify(e.object.level.getCharacters(),null,2)),children:"Copy characters"}),n(V,{onClick:()=>W(c),children:"Copy level"}),n(V,{onClick:()=>{I.save(e.name,e.object.serialize()),r.reloadLevels()},children:"Save"})]}),u("div",{children:[n(j,{label:"width",value:e.level.width,variant:"standard",onChange:h=>{e.object.level.changeSize(parseInt(h.target.value),e.level.height),e.object.render()}}),n(j,{label:"height",value:e.level.height,variant:"standard",onChange:h=>{e.object.level.changeSize(e.level.width,parseInt(h.target.value)),e.object.render()}}),n(V,{onClick:()=>{e.object.level.crop(e.object.level.width,e.object.level.height),e.object.render()},children:"Crop"})]}),n(Ne,{game:e,onClick:h=>s(h)}),n("div",{children:n("pre",{children:n("div",{children:c})})}),u(He,{open:t!==!1,onClose:()=>s(!1),children:[n(_e,{children:t}),u(Ae,{children:[n("div",{children:n(b,{value:i==null?void 0:i.getType(),onChange:h=>{const p=ce(t);let N;h.target.value===y.Empty&&(N=new J(e.object.level,p[0],p[1])),h.target.value===y.Wall&&(N=new K(e.object.level,p[0],p[1])),h.target.value===y.Hole&&(N=new Z(e.object.level,p[0],p[1]),N.isEmpty=!0),h.target.value===y.Printer&&(N=new q(e.object.level,p[0],p[1]),N.isEmpty=!0),h.target.value===y.Shredder&&(N=new B(e.object.level,p[0],p[1]),N.isEmpty=!0),N&&e.object.level.addCell(p[0],p[1],N),e.object.render()},children:Object.values(y).map(h=>n(g,{value:h,children:h},h))})}),(i==null?void 0:i.getType())==="empty"?u("div",{children:["Item:"," ",n(ne,{checked:!!(i==null?void 0:i.item),onChange:h=>{h.target.checked?i.setItem(new X(0)):i.setItem(null),e.object.render()}})]}):null,(i==null?void 0:i.item)?n("div",{children:n(j,{label:"Item value",value:(D=i==null?void 0:i.item)==null?void 0:D.value,variant:"standard",onChange:h=>{i.item.value=parseInt(h.target.value)||0,e.object.render()}})}):null,(i==null?void 0:i.getType())==="empty"?u("div",{children:["Character:"," ",n(ne,{checked:!!i.character,onChange:h=>{h.target.checked?(i.setCharacter(new de(i,`${e.object.level.getCharacters().length+1}`)),i.character.color="green"):i.character=null,e.object.render()}})]}):null]})]})]})}const Lt=We({components:{MuiTextField:{styleOverrides:{root:{width:"50px","& input":{textAlign:"center"}}}},MuiSelect:{styleOverrides:{select:{paddingLeft:"24px"}}}}});I.preloadLevels();function Nt(){const[r,e]=E.exports.useState(0),[l,t]=E.exports.useState(!1),[s,i]=E.exports.useState(I.getLevels());return n(qe,{theme:Lt,children:u("div",{className:"App",children:[n("h1",{children:"Open7BH"}),u(Be,{value:l?1:0,onChange:(d,c)=>t(c===1),children:[n(ae,{label:"Game"}),n(ae,{label:"Editor"})]}),l?n(Dt,{levels:s,reloadLevels:()=>i(I.getLevels())}):u(_,{children:[n("div",{children:n(b,{variant:"standard",value:r,onChange:d=>e(parseInt(d.target.value)),children:s.map((d,c)=>n(g,{value:c,children:d.level.task},c))})}),n(yt,{level:s[r],levelNumber:r})]})]})})}const Vt="modulepreload",Ve={},zt="./",kt=function(e,l){return!l||l.length===0?e():Promise.all(l.map(t=>{if(t=`${zt}${t}`,t in Ve)return;Ve[t]=!0;const s=t.endsWith(".css"),i=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${i}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":Vt,s||(a.as="script",a.crossOrigin=""),a.href=t,document.head.appendChild(a),s)return new Promise((d,c)=>{a.addEventListener("load",d),a.addEventListener("error",c)})})).then(()=>e())},Et=r=>{r&&r instanceof Function&&kt(()=>import("./web-vitals.67dce932.js"),[]).then(({getCLS:e,getFID:l,getFCP:t,getLCP:s,getTTFB:i})=>{e(r),l(r),t(r),s(r),i(r)})},Tt=Je.createRoot(document.getElementById("root"));Tt.render(n(Qe.StrictMode,{children:n(Nt,{})}));Et();
